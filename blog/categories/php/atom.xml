<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: php | Wern Ancheta]]></title>
  <link href="http://anchetawern.github.io/blog/categories/php/atom.xml" rel="self"/>
  <link href="http://anchetawern.github.io/"/>
  <updated>2015-04-05T13:25:03+08:00</updated>
  <id>http://anchetawern.github.io/</id>
  <author>
    <name><![CDATA[Wern Ancheta]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Getting Started with the Yahoo Finance API]]></title>
    <link href="http://anchetawern.github.io/blog/2015/04/05/getting-started-with-the-yahoo-finance-api/"/>
    <updated>2015-04-05T13:24:00+08:00</updated>
    <id>http://anchetawern.github.io/blog/2015/04/05/getting-started-with-the-yahoo-finance-api</id>
    <content type="html"><![CDATA[<p>The Yahoo Finance API provides a way for developers to get the latest information about the stock market. How the different stocks are doing. What&rsquo;s the current buying price for a single stock. How much is the difference of the current market value to that of yesterday&rsquo;s, etc.</p>

<p>First thing that you need to do is to install the Guzzle library for PHP. This allows us to easily make http requests to the server. You can do that by adding the following on your <code>composer.json</code> file:</p>

<p>```
 {
   &ldquo;require&rdquo;: {</p>

<pre><code>  "guzzlehttp/guzzle": "~5.0"
</code></pre>

<p>   }
}
```</p>

<p>Then execute <code>composer install</code> from your terminal.</p>

<p>Next create a <code>test.php</code> file and put the following code:</p>

<p><code>php
&lt;?php
require 'vendor/autoload.php';
$client = new GuzzleHttp\Client();
?&gt;
</code></p>

<p>This allows us to use guzzle from our file.</p>

<p>Before we move on here are the specific data that you can get from the API:</p>

<p><strong>Pricing</strong></p>

<ul>
<li><code>a</code> &ndash; ask</li>
<li><code>b</code> &ndash; bid</li>
<li><code>b2</code> &ndash; ask (realtime)</li>
<li><code>b3</code> &ndash; bid (realtime)</li>
<li><code>p</code> &ndash; previous close</li>
<li><code>o</code> &ndash; open</li>
</ul>


<p><strong>Dividends</strong></p>

<ul>
<li><code>y</code> &ndash; dividend yield</li>
<li><code>d</code> &ndash; dividend per share</li>
<li><code>r1</code> &ndash; dividend pay date</li>
<li><code>q</code> &ndash; ex-dividend date</li>
</ul>


<p><strong>Date</strong></p>

<ul>
<li><code>c1</code> &ndash; change</li>
<li><code>c</code> &ndash; change &amp; percentage change</li>
<li><code>c6</code> &ndash; change (realtime)</li>
<li><code>k2</code> &ndash; change percent</li>
<li><code>p2</code> &ndash; change in percent</li>
<li><code>d1</code> &ndash; last trade date</li>
<li><code>d2</code> &ndash; trade date</li>
<li><code>t1</code> &ndash; last trade time</li>
</ul>


<p><strong>Averages</strong></p>

<ul>
<li><code>c8</code> &ndash; after hours change</li>
<li><code>c3</code> &ndash; commission</li>
<li><code>g</code> &ndash; day&rsquo;s low</li>
<li><code>h</code> &ndash; day&rsquo;s high</li>
<li><code>k1</code> &ndash; last trade (realtime) with time</li>
<li><code>l</code> &ndash; last trade (with time)</li>
<li><code>l1</code> &ndash; last trade (price only)</li>
<li><code>t8</code> &ndash; 1 yr target price</li>
<li><code>m5</code> &ndash; change from 200 day moving average</li>
<li><code>m6</code> &ndash; percent change from 200 day moving average</li>
<li><code>m7</code> &ndash; change from 50 day moving average</li>
<li><code>m8</code> &ndash; percent change from 50 day moving average</li>
<li><code>m3</code> &ndash; 50 day moving average</li>
<li><code>m4</code> &ndash; 200 day moving average</li>
</ul>


<p><strong>Misc</strong></p>

<ul>
<li><code>w1</code> &ndash; day&rsquo;s value change</li>
<li><code>w4</code> &ndash; day&rsquo;s value change (realtime)</li>
<li><code>p1</code> &ndash; price paid</li>
<li><code>m</code> &ndash; day&rsquo;s range</li>
<li><code>m2</code> &ndash; day&rsquo;s range (realtime)</li>
<li><code>g1</code> &ndash; holding gain percent</li>
<li><code>g3</code> &ndash; annualized gain</li>
<li><code>g4</code> &ndash; holdings gain</li>
<li><code>g5</code> &ndash; holdings gain percent (realtime)</li>
<li><code>g6</code> &ndash; holdings gain (realtime)</li>
<li><code>t7</code> &ndash; ticker trend</li>
<li><code>t6</code> &ndash; trade links</li>
<li><code>i5</code> &ndash; order book (realtime)</li>
<li><code>l2</code> &ndash; high limit</li>
<li><code>l3</code> &ndash; low limit</li>
<li><code>v1</code> &ndash; holdings value</li>
<li><code>v7</code> &ndash; holdings value (realtime)</li>
<li><code>s6</code> &ndash; revenue</li>
</ul>


<p><strong>52 Week Pricing</strong></p>

<ul>
<li><code>k</code> &ndash; 52 week high</li>
<li><code>j</code> &ndash; 52 week low</li>
<li><code>j5</code> &ndash; change from 52 week low</li>
<li><code>k4</code> &ndash; change from 52 week high</li>
<li><code>j6</code> &ndash; percent change from 52 week low</li>
<li><code>k5</code> &ndash; percent change from 52 week high</li>
<li><code>w</code> &ndash; 52 week range</li>
</ul>


<p><strong>Symbol Info</strong></p>

<ul>
<li><code>v</code> &ndash; more info</li>
<li><code>j1</code> &ndash; market capitalization</li>
<li><code>j3</code> &ndash; market cap (realtime)</li>
<li><code>f6</code> &ndash; float shares</li>
<li><code>n</code> &ndash; name</li>
<li><code>n4</code> &ndash; notes</li>
<li><code>s</code> &ndash; symbol</li>
<li><code>s1</code> &ndash; shares owned</li>
<li><code>x</code> &ndash; stock exchange</li>
<li><code>j2</code> &ndash; shares outstanding</li>
</ul>


<p><strong>Volume</strong></p>

<ul>
<li><code>v</code> &ndash; volume</li>
<li><code>a5</code> &ndash; ask size</li>
<li><code>b6</code> &ndash; bid size</li>
<li><code>k3</code> &ndash; last trade size</li>
<li><code>a2</code> &ndash; average daily volume</li>
</ul>


<p><strong>Ratios</strong></p>

<ul>
<li><code>e</code> &ndash; earnings per share</li>
<li><code>e7</code> &ndash; eps estimate current year</li>
<li><code>e8</code> &ndash; eps estimate next year</li>
<li><code>e9</code> &ndash; eps estimate next quarter</li>
<li><code>b4</code> &ndash; book value</li>
<li><code>j4</code> &ndash; EBITDA</li>
<li><code>p5</code> &ndash; price / sales</li>
<li><code>p6</code> &ndash; price / book</li>
<li><code>r</code> &ndash; P/E ratio</li>
<li><code>r2</code> &ndash; P/E ratio (realtime)</li>
<li><code>r5</code> &ndash; PEG ratio</li>
<li><code>r6</code> &ndash; price / eps estimate current year</li>
<li><code>r7</code> &ndash; price /eps estimate next year</li>
<li><code>s7</code> &ndash; short ratio</li>
</ul>


<p>Wew! Ok so that&rsquo;s a lot. I&rsquo;ll let you catch your breath for a second. Ready?</p>

<p>Ok so now were ready to make a request to the API. You can either do that from here:</p>

<p><code>
http://download.finance.yahoo.com/d/quotes.csv?s={SYMBOLS}&amp;f={DATA THAT WE WANT}
</code></p>

<p>Or here:</p>

<p><code>
http://finance.yahoo.com/d/quotes.csv?s={SYMBOLS}&amp;f={DATA THAT WE WANT}
</code></p>

<p>Doesn&rsquo;t really matter which. Both returns the same thing. Here&rsquo;s an example which you can just copy and paste into your browser&rsquo;s address bar:</p>

<p><code>
http://finance.yahoo.com/d/quotes.csv?s=GOOGL&amp;f=abo
</code></p>

<p>Breaking it down. We make a request to this URL:</p>

<p><code>
http://finance.yahoo.com/d/quotes.csv
</code></p>

<p>And then we pass in some query parameters: <code>s</code> and <code>f</code>. <code>s</code> represents the symbol or symbols that you want to query. And <code>f</code> represents the data that you want. That&rsquo;s the big list that we just went through earlier. So if you want the API to return the ask, bid and open. We just need to pass in:</p>

<p><code>
f=abo
</code></p>

<p>In the example that we have. Were requesting this information for the <code>GOOGL</code> symbol. Which is basically Google. When this is requested in the browser, it downloads a <code>quotes.csv</code> file which contain something similar to the following:</p>

<p><code>
580.36,575.90,576.35
</code></p>

<p>Its a comma-separated list of all the values you requested. So 580.36 is the ask price, 575.90 is the bidding price, and 576.35 is the open price.</p>

<p>If you want to query more than one symbol, you just separate each symbol with a comma. So for example you want to request the stock information about Google, Apple, Microsoft and Facebook:</p>

<p><code>
http://finance.yahoo.com/d/quotes.csv?s=GOOGL,AAPL,MSFT,FB&amp;f=abo
</code></p>

<p>Now let&rsquo;s proceed with actually making this all work with PHP. First we need to create a table that will store all the information that we need. In this case, we only need the symbol, ask, bid and open values:</p>

<p>```sql
CREATE TABLE symbols (</p>

<pre><code>id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
symbol VARCHAR(30) NOT NULL,
ask DOUBLE,
bid DOUBLE,
open DOUBLE
</code></pre>

<p>)
```</p>

<p>Next create an <code>indexer.php</code> file. What this file does is to query the yahoo finance api and then save the results to a csv file. Note that we can only query up to 200 symbols per request. So we&rsquo;ll have to work based on that on our code.</p>

<p>The first thing that the code below does is to query the number of symbols currently in the database. And then we calculate how many times we need to loop in order to update all the symbols. We also need to declare the file path of the csv file in which will save all the results from the API. And initialize it by setting its value to an empty string. Then we declare the format <code>sabo</code>. Which means symbol, ask, bid and open. Next we create a for loop that will keep on executing until the value of <code>$x</code> reaches the total loop times that we got from dividing the total number of symbols by the API limit. Inside the loop we calculate the offset value by multiplying the current value of <code>$x</code> by the API limit. After that, we select the symbols that we need based on that. Then we loop through the results, specifically the symbol and then put them in an array. After looping through all the results, we convert the array into a comma separated list. This allows us to use this value for querying the API. Once we get the result back, we just save it to the csv file using <code>file_put_contents</code>.</p>

<p>```php
&lt;?php
require &lsquo;vendor/autoload.php&rsquo;;
$db = new Mysqli(HOST, USER, PASS, DB);
$client = new GuzzleHttp\Client();</p>

<p>$symbols_count_result = $db->query(&ldquo;SELECT COUNT(id) FROM symbols&rdquo;);
$symbol_row = $symbols_count_result->fetch_row();
$symbol_count = $symbol_row[0];</p>

<p>$api_limit = 200;</p>

<p>$loop_times = $symbol_count / $api_limit;
$loop_times = floor($loop_times) + 1;</p>

<p>$file = &lsquo;uploads/csv/stocks.csv&rsquo;;
file_put_contents($file, &lsquo;&rsquo;);</p>

<p>$format = &lsquo;sabo&rsquo;;</p>

<p>for($x = 0; $x &lt; $loop_times; $x++){</p>

<pre><code>$from = $x * $api_limit;
$symbols_result = $db-&gt;query("SELECT * FROM symbols LIMIT '$api_limit' OFFSET '$from'");

if($symbols_result-&gt;num_rows &gt; 0){

    $symbols = array();
    while($row = $symbols_result-&gt;fetch_object()){
        symbols[] = $row-&gt;symbol;
    } 

    $symbols_str = implode(',', $symbols);
    $stocks = $client-&gt;get("http://download.finance.yahoo.com/d/quotes.csv?s={$symbols_str}&amp;f={$format}");

    file_put_contents($file, $stocks-&gt;getBody(), FILE_APPEND);
}
</code></pre>

<p>}      <br/>
?>
```</p>

<p>That&rsquo;s it! The Yahoo Finance API is a really nice way of getting financial information about specific companies.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Getting Started with Stripe API]]></title>
    <link href="http://anchetawern.github.io/blog/2015/03/22/getting-started-with-stripe-api/"/>
    <updated>2015-03-22T11:08:00+08:00</updated>
    <id>http://anchetawern.github.io/blog/2015/03/22/getting-started-with-stripe-api</id>
    <content type="html"><![CDATA[<p>In this tutorial I&rsquo;ll walk you through the Stripe&rsquo;s API. Let&rsquo;s start by defining what Stripe is. From the Stripe website itself:</p>

<p><blockquote><p>Stripe is a developer-friendly way to accept payments online and in mobile apps.<br/>We process billions of dollars a year for thousands of companies of all sizes.</p></blockquote></p>

<p>Now we know that Stripe is a payment processor, similar to Paypal.</p>

<p>With Stripe, you can accept payments in three ways:</p>

<ul>
<li>Embedded Form</li>
<li>Custom Form</li>
<li>Mobile App Integration</li>
</ul>


<p>In this tutorial I&rsquo;ll only be walking you through the first two: embedded form and custom form.</p>

<h3>Embedded Form</h3>

<p>If you do not want to bother with creating your own checkout forms, an embedded form is the way to go. An embedded form is basically Stripe&rsquo;s checkout widget. All you have to do is include their script on your website, specifically inside a form element. And the front-end side is already handled for you.</p>

<p>```html
<form action="/checkout.php" method="POST">
  &lt;script</p>

<pre><code>src="https://checkout.stripe.com/checkout.js" class="stripe-button"
data-key="pk_test_xxxxxxxxxxxxxxxxxxx"
data-amount="1000"
data-name="Web Development"
data-description="Develop a website"
data-image="http://mywebsite.com/img/logo.png"&gt;
</code></pre>

<p>  </script>
</form>
```</p>

<p>Breaking it down. For the script to work, you need to supply a value to the following attributes:</p>

<ul>
<li><code>src</code> &ndash; Stripe&rsquo;s checkout script. This should be <code>https://checkout.stripe.com/checkout.js</code></li>
<li><code>data-key</code> &ndash; your stripe publishable key. You can find it by clicking on your username, then select &lsquo;account settings&rsquo;, then click on the &lsquo;api keys&rsquo; tab. From there you can use either your test publishable key or your live publishable key. The test key is used for testing. This allows you to supply a fake credit card number and pay for a fake product or service. After successful payment, you can see your fake client from the <a href="https://dashboard.stripe.com/customers">customers</a> page on your Stripe dashboard. Don&rsquo;t forget to switch to <a href="https://dashboard.stripe.com/test/customers">test</a>.</li>
<li><code>data-amount</code> &ndash; the amount you want to charge in cents. Just multiply what you want to charge by 100. So for example you want to charge $10, you need to supply 1000 instead.</li>
<li><code>data-name</code> &ndash; the name of your product or service.</li>
<li><code>data-description</code> &ndash; the description of your product or service.</li>
<li><code>data-image</code> &ndash; your logo. This should be an absolute url.</li>
</ul>


<p>Next we need to install Stripe&rsquo;s library via <a href="https://getcomposer.org/">composer</a>. Add the following code on your <code>composer.json</code> file:</p>

<p>```
{
  &ldquo;require&rdquo;: {</p>

<pre><code>"stripe/stripe-php": "2.*"
</code></pre>

<p>  }
}
```</p>

<p>Once that&rsquo;s done, execute <code>composer install</code> from your terminal. This will fetch the library from the repository.</p>

<p>Next create the <code>checkout.php</code> file and add the following code:</p>

<p>```php
&lt;?php
require &lsquo;vendor/autoload.php&rsquo;;</p>

<p>\Stripe\Stripe::setApiKey(&lsquo;sk_test_xxxxxxxxxxxxxx&rsquo;);</p>

<p>$token = $<em>POST[&lsquo;stripeToken&rsquo;];
$email = $</em>POST[&lsquo;stripeEmail&rsquo;];</p>

<p>try {</p>

<pre><code>$charge = \Stripe\Charge::create(array(
  "amount" =&gt; 1000, 
  "currency" =&gt; "usd",
  "source" =&gt; $token,
  "description" =&gt; $email)
);

print_r($charge);
</code></pre>

<p>}catch(\Stripe\Error\Card $e){</p>

<pre><code>echo $e-&gt;getMessage();
</code></pre>

<p>}
?>
```</p>

<p>Breaking it down, first we included the <code>vendor/autoload.php</code> file so that we can use the Stripe library on our script. Next we initialize the library by setting the Stripe secret key. Next we get the data supplied by Stripe for us from the front-end. The <code>stripeToken</code> is the unique token generated by Stripe, this represents the transaction that the client made on the front-end. That is, paying $10 for our service. Next is the <code>stripeEmail</code>, this is basically just the email supplied by the client. Next we wrap the stripe charge call in a try catch statement. This allows us to capture any error returned by the API and show it to the client. Calling the stripe charge method requires 4 arguments:</p>

<ul>
<li><code>amount</code> &ndash; the amount that you want to charge in cents.</li>
<li><code>currency</code> &ndash; the currency code representing the currency that we want to use.</li>
<li><code>source</code> &ndash; the token that stripe generated on the front-end.</li>
<li><code>description</code> &ndash; a text that we want to assign to the charge. This is usually the clients email. But you can add more details such as the name of the service if you&rsquo;re offering more than one product or service.</li>
</ul>


<p>If the API call is successful, this method returns a whole bunch of data. Such as the amount paid, and the description. In most cases you&rsquo;ll basically only want the id of the transaction. You can get this by accessing the <code>id</code> property:</p>

<p><code>
$charge_id = $charge-&gt;id;
</code></p>

<p>You can then save this on your database as a reference. But of course you can always see this on <a href="https://dashboard.stripe.com/test/payments">your payments page</a>.</p>

<h3>Custom Forms</h3>

<p>If you need to ask additional information from your clients. Or you just want to use your own form. You can use custom forms. This allows you to write your own markup, supply your own fields and style them the way you want it with css. Here&rsquo;s an example of how a custom checkout form might look like:</p>

<p>```html
<form action="checkout.php" method="POST" id="payment-form">
  <div class="errors"></div></p>

<p>  <div></p>

<pre><code>&lt;label for="email"&gt;Email&lt;/label&gt;
&lt;input type="email" id="email" name="email"&gt;
</code></pre>

<p>  </div></p>

<p>  <div></p>

<pre><code>&lt;label for="name"&gt;Name&lt;/label&gt;
&lt;input type="text" id="name" name="name"&gt;
</code></pre>

<p>  </div></p>

<p>  <div></p>

<pre><code>&lt;label for="card-number"&gt;Card Number&lt;/label&gt;
&lt;input type="text" size="20" data-stripe="number" id="card-number" name="card-number"&gt;
</code></pre>

<p>  </div></p>

<p>  <div></p>

<pre><code>&lt;label for="cvc"&gt;Security Code&lt;/label&gt;
&lt;input type="text" size="4" data-stripe="cvc" id="cvc" name="cvc"&gt;
</code></pre>

<p>  </div></p>

<p>  <div></p>

<pre><code>&lt;label&gt;Expiration (MM/YYYY)&lt;/label&gt;
&lt;input type="text" data-stripe="exp-month" name="exp-month"&gt;
&lt;span&gt; / &lt;/span&gt;
&lt;input type="text" data-stripe="exp-year" name="exp-year"/&gt;
</code></pre>

<p>  </div></p>

<p>  <button type="submit">Pay</button>
</form>
```</p>

<p>This form works with the Stripe checkout script by adding the <code>data-stripe</code> attribute to the following fields. Just supply the value on the right-hand side as the value for the <code>data-stripe</code> attribute depending on the field:</p>

<ul>
<li>card number &ndash; <code>card-number</code></li>
<li>security code or cvc &ndash; <code>cvc</code></li>
<li>card expiration month &ndash; <code>exp-month</code></li>
<li>card expiration year &ndash; <code>exp-year</code></li>
</ul>


<p>Next we need to include the stripe checkout script:</p>

<p>```html</p>

<script type="text/javascript" src="https://js.stripe.com/v2/"></script>


<p>```</p>

<p>And then set the publishable key. This allows stripe to identify which stripe account the request came from:</p>

<p>```html</p>

<script>
Stripe.setPublishableKey('pk_test_xxxxxxxxxxxxxxxxxxx');
</script>


<p>```</p>

<p>Next we need to define the method that will process the response that we get from Stripe when the client submits the payment form. This takes up 2 parameters: status and response. The status is the <a href="https://stripe.com/docs/api#errors">status code</a>. The response contains the actual Stripe response. This is an object containing information about the transaction. One of those is the <code>id</code> which is basically the token that we need to pass in to the back-end. All we have to do is to append it to the payment form so it gets submitted with the rest of the fields. If there is an error with the request, an error property becomes available in the response object. This contains the error message, we just show it to the user by supplying it as a value to the <code>errors</code> div. After that, we enable the submit button so the client can fix the errors and submit the form again:</p>

<p>```javascript
function processStripeResponse(status, response){
  var form = $(&lsquo;#payment-form&rsquo;);</p>

<p>  if(response.error){</p>

<pre><code>form.find('.errors').text(response.error.message);
form.find('button').prop('disabled', false);
</code></pre>

<p>  }else{</p>

<pre><code>var token = response.id;
form.append($('&lt;input type="hidden" name="stripeToken" /&gt;').val(token));
form.get(0).submit();
</code></pre>

<p>  }
};
```</p>

<p>Next we define the event handler for when the payment form is submitted. This calls the <code>createToken</code> method which requires the payment form and the response handler as its arguments. Don&rsquo;t forget to return <code>false</code> so the form doesn&rsquo;t get submitted. The response handler will be the one which will trigger the submit if the response doesn&rsquo;t have any errors:</p>

<p>```javascript
$(function(){
  $(&lsquo;#payment-form&rsquo;).submit(function(event) {</p>

<pre><code>var form = $(this);
form.find('button').prop('disabled', true);

Stripe.card.createToken(form, processStripeResponse);

return false;
</code></pre>

<p>  });
});</p>

<p>```</p>

<p>On the back-end we can just use the previous code and use the custom fields that we added. Note that the <code>stripeToken</code> field stays the same. We don&rsquo;t need to pass the card number, security code and expiration date:</p>

<p>```php
&lt;?php
require &lsquo;vendor/autoload.php&rsquo;;</p>

<p>\Stripe\Stripe::setApiKey(&lsquo;sk_test_xxxxxxxxxxxxxx&rsquo;);</p>

<p>$token = $_POST[&lsquo;stripeToken&rsquo;];</p>

<p>$email = $<em>POST[&lsquo;email&rsquo;];
$name = $</em>POST[&lsquo;name&rsquo;];</p>

<p>try {</p>

<pre><code>$charge = \Stripe\Charge::create(array(
  "amount" =&gt; 1000, 
  "currency" =&gt; "usd",
  "source" =&gt; $token,
  "description" =&gt; $email)
);

print_r($charge);
</code></pre>

<p>}catch(\Stripe\Error\Card $e){</p>

<pre><code>echo $e-&gt;getMessage();
</code></pre>

<p>}
?>
```</p>

<h3>Conclusion</h3>

<p>That&rsquo;s it! You&rsquo;ve learned how to interact with the Stripe API in order to easily process payments.</p>

<h3>Resources</h3>

<ul>
<li><a href="https://stripe.com/docs">Stripe Docs</a></li>
<li><a href="https://stripe.com/docs/api?lang=php">Stripe API</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Getting Started with RabbitMQ in PHP]]></title>
    <link href="http://anchetawern.github.io/blog/2014/11/16/getting-started-with-rabbitmq-in-php/"/>
    <updated>2014-11-16T15:11:00+08:00</updated>
    <id>http://anchetawern.github.io/blog/2014/11/16/getting-started-with-rabbitmq-in-php</id>
    <content type="html"><![CDATA[<p><blockquote><p>This article was originally published at Binpress:<br/><a href="http://www.binpress.com/tutorial/getting-started-with-rabbitmq-in-php/164">http://www.binpress.com/tutorial/getting-started-with-rabbitmq-in-php/164</a></p></blockquote></p>

<p>In this tutorial I&rsquo;m going to walk you through how you can use RabbitMQ in PHP. But first what is RabbitMQ? RabbitMQ is a message broker software. It acts as a middleman between a producer and a consumer. Producer being the data that we want to pass, and consumer being the entity that we want to pass it to. RabbitMQ uses a queue, you can think of it as a mailbox where you drop your letters. RabbitMQ then takes the letters and delivers it to its destination.</p>

<h3>Installing RabbitMQ</h3>

<p>In Ubuntu and other debian based operating system you can install RabbitMQ by executing the following commands from your terminal:</p>

<p><code>
echo "deb http://www.rabbitmq.com/debian/ testing main"  | sudo tee  /etc/apt/sources.list.d/rabbitmq.list &gt; /dev/null
sudo wget http://www.rabbitmq.com/rabbitmq-signing-key-public.asc
sudo apt-key add rabbitmq-signing-key-public.asc
sudo apt-get update
sudo apt-get install rabbitmq-server -y
sudo service rabbitmq-server start
sudo rabbitmq-plugins enable rabbitmq_management
sudo service rabbitmq-server restart
</code></p>

<p>What the first command does is to append the rabbitmq source to the software sources list. Next we download the rabbitmq signing key using <code>wget</code>. Then add the key to Ubuntu. Next we call <code>apt-get update</code> to update the software sources list. Next we install the RabbitMQ server, start it then enable RabbitMQ management plugin. This provides an HTTP-based API management for monitoring your RabbitMQ server. Finally we restart the RabbitMQ server so that changes will take effect.
The default username and password is <code>guest</code>. And the default port in which it runs is <code>5672</code>.</p>

<p>If you&rsquo;re on another operating system, you can find how to install RabbitMQ for your specific operating system here: <a href="http://www.rabbitmq.com/download.html">Downloading and Installing RabbitMQ</a>.</p>

<h3>Working with RabbitMQ</h3>

<p>Once you&rsquo;re done installing RabbitMQ, we can now install the AMQP library for PHP. This implements the AMQP (Advanced Messaging Queue Protocol) protocol. As the name suggests it is a protocol used for messaging.
Start by creating a new directory, this is where we will put all the files for testing RabbitMQ. Next create a composer.json file and add the following:</p>

<p>```
{
  &ldquo;require&rdquo;: {</p>

<pre><code>  "videlalvaro/php-amqplib": "2.2.*"
</code></pre>

<p>  }
}
```</p>

<p>Next, open up your terminal and <code>cd</code> into the directory you created earlier then execute <code>composer install</code> to install the AMQP library.</p>

<p>Before we move on, lets also install <a href="http://swiftmailer.org/">Swiftmailer</a>. You can do that by executing the following command from your terminal. This also adds an entry to Swiftmailer to your composer.json:</p>

<p><code>
composer require swiftmailer/swiftmailer @stable
</code></p>

<p>We will be using Swiftmailer for the sample app that were going to create. What we will do is create an app that will send emails for our users. Normally emails takes a few seconds before it is sent, adding an attachment to the email also adds to that time. In the real world we don&rsquo;t really want our users to wait. What we want to do is make them believe that we have already sent the email for them by outputting to the screen that their message has been sent.
This is where RabbitMQ comes in. We will use it as some sort of a mailbox in which multiple users can just drop their messages in. RabbitMQ will then take care of sending the messages in the background.</p>

<h4>Sending Messages</h4>

<p>First lets create the form to be used for sending emails. This will accept the name and email address of the sender, the email address of the receiver and then the subject and message. Name the file <code>form.php</code>:</p>

<p>```html
&lt;?php
if(!empty($_GET[&lsquo;sent&rsquo;])){
?></p>

<div>
    Your message was sent!
</div>


<p>&lt;?php
}
?>
<form action="mailer.php" method="POST"></p>

<pre><code>&lt;div&gt;
    &lt;label for="from"&gt;From&lt;/label&gt;
    &lt;input type="text" name="from" id="from"&gt;       
&lt;/div&gt;
&lt;div&gt;
    &lt;label for="from_email"&gt;From Email&lt;/label&gt;
    &lt;input type="text" name="from_email" id="from_email"&gt;       
&lt;/div&gt;
&lt;div&gt;
    &lt;label for="to_email"&gt;To Email&lt;/label&gt;
    &lt;input type="text" name="to_email" id="to_email"&gt;           
&lt;/div&gt;
&lt;div&gt;
    &lt;label for="subject"&gt;Subject&lt;/label&gt;
    &lt;input type="text" name="subject" id="subject"&gt;
&lt;/div&gt;
&lt;div&gt;
    &lt;label for="message"&gt;Message&lt;/label&gt;
    &lt;textarea name="message" id="message" cols="30" rows="10"&gt;&lt;/textarea&gt;   
&lt;/div&gt;
&lt;div&gt;
    &lt;button type="submit"&gt;Send&lt;/button&gt;
&lt;/div&gt;
</code></pre>

<p></form>
```</p>

<p>Next, create the file which will push the message into the queue. Name the file <code>sender.php</code>.
Require the <code>autoload.php</code> file so that our dependencies will be automatically loaded by PHP. Then use the <code>AMQPConnection</code> and <code>AMQPMessage</code> from the AMQP library. <code>AMQPConnection</code> allows us to create a new connection to the RabbitMQ server and <code>AMQPMessage</code> allows us to create messages that we can push to the queue.</p>

<p>```php
&lt;?php
require_once <strong>DIR</strong> . &lsquo;/vendor/autoload.php&rsquo;;
use PhpAmqpLib\Connection\AMQPConnection;
use PhpAmqpLib\Message\AMQPMessage;</p>

<p>$connection = new AMQPConnection(&lsquo;localhost&rsquo;, 5672, &lsquo;guest&rsquo;, &lsquo;guest&rsquo;);
$channel = $connection->channel();</p>

<p>$channel->queue_declare(&lsquo;email_queue&rsquo;, false, false, false, false);</p>

<p>$data = json_encode($_POST);</p>

<p>$msg = new AMQPMessage($data, array(&lsquo;delivery_mode&rsquo; => 2));
$channel->basic_publish($msg, &lsquo;&rsquo;, &lsquo;email_queue&rsquo;);</p>

<p>header(&lsquo;Location: form.php?sent=true&rsquo;);
?>
```</p>

<p>Breaking it down, first we create a new connection by creating a new instance of the <code>AMQPConnection</code> class. This requires the following arguments:</p>

<ul>
<li><strong>host</strong> &ndash; the host in which the RabbitMQ server is running. In this case we&rsquo;ve installed RabbitMQ on the same computer we are running the script in. So it should be <code>localhost</code>. Note that in the real world we install RabbitMQ on a another server, different from the one were using to serve our websites. So instead of <code>localhost</code> we use the public ip address of that server.</li>
<li><strong>port</strong> &ndash; the port in which the RabbitMQ server is running.</li>
<li><strong>user</strong> &ndash; the username to use for logging in to the server. By default the username is set to <code>guest</code>.</li>
<li><strong>password</strong> &ndash; the password of the user. By default the password is set to <code>guest</code>.</li>
</ul>


<p>Next we create a channel. We can do that by calling the <code>channel()</code> method from the connection that we have just declared.</p>

<p><code>
&lt;?php
$channel = $connection-&gt;channel();
?&gt;
</code></p>

<p>Next we declare the queue to be used by calling the  <code>queue_declare</code> method.</p>

<p><code>
&lt;?php
$channel-&gt;queue_declare('email_queue', false, false, false, false);
?&gt;
</code></p>

<p>The <code>queue_declare</code> method takes up the following arguments:</p>

<ul>
<li><strong>queue name</strong> &ndash; a name that you want to use for the queue, you can supply anything for this.</li>
<li><strong>passive</strong> &ndash; a boolean value for specifying whether to check for an existing exchange.</li>
<li><strong>durable</strong> &ndash; a boolean value for specifying whether the RabbitMQ holds on to a queue when the server crashes.</li>
<li><strong>exclusive</strong> &ndash; a boolean value for specifying whether the queue is used by only one connection.</li>
<li><strong>auto-delete</strong> &ndash; a boolean value for specifying whether the queue is deleted when the last subscriber unsubscribes.</li>
</ul>


<p>Next we convert the POST data that we receive from the form to a JSON string. We can only pass strings as a message so we&rsquo;ll have to convert this later on into an array on the receiver&rsquo;s end.</p>

<p><code>
&lt;?php
$data = json_encode($_POST);
?&gt;
</code></p>

<p>Next we create a new message. This accepts 2 arguments: the data and an array of options. For the array of options we specify the <code>delivery_mode</code> to 2 which means that the message is persistent. This means that it isn&rsquo;t lost when the server crashes or an error occurs.</p>

<p><code>
&lt;?php
$msg = new AMQPMessage($data, array('delivery_mode' =&gt; 2));
?&gt;
</code></p>

<p>Next we publish the message by calling the <code>basic_publish()</code> method on the channel. This accepts 3 arguments: the message, the exchange and the name of the queue. If you&rsquo;re wondering why we set the value of exchange to an empty string, that&rsquo;s because we don&rsquo;t really need it. The exchange is commonly used for pub-sub patterns. What were using here is just basic publish.</p>

<p><code>
&lt;?php
$channel-&gt;basic_publish($msg, '', 'email_queue');
?&gt;
</code></p>

<p>Finally we just redirect the user to the form.</p>

<p><code>
&lt;?php
header('Location: form.php?sent=true');
?&gt;
</code></p>

<h4>Receiving Messages</h4>

<p>Now were ready to write the code that will receive the messages sent by users. Name the file <code>receiver.php</code>. Here&rsquo;s the full contents of the file:</p>

<p>```
&lt;?php
require_once <strong>DIR</strong> . &lsquo;/vendor/autoload.php&rsquo;;
use PhpAmqpLib\Connection\AMQPConnection;</p>

<p>$connection = new AMQPConnection(&lsquo;localhost&rsquo;, 5672, &lsquo;guest&rsquo;, &lsquo;guest&rsquo;);
$channel = $connection->channel();</p>

<p>$channel->queue_declare(&lsquo;email_queue&rsquo;, false, false, false, false);</p>

<p>echo &lsquo; * Waiting for messages. To exit press CTRL+C&rsquo;, &ldquo;\n&rdquo;;</p>

<p>$callback = function($msg){</p>

<pre><code>echo " * Message received", "\n";
$data = json_decode($msg-&gt;body, true);

$from = $data['from'];
$from_email = $data['from_email'];
$to_email = $data['to_email'];
$subject = $data['subject'];
$message = $data['message'];

$transporter = Swift_SmtpTransport::newInstance('smtp.gmail.com', 465, 'ssl')
  -&gt;setUsername('YOUR_GMAIL_EMAIL')
  -&gt;setPassword('YOUR_GMAIL_PASSWORD');

$mailer = Swift_Mailer::newInstance($transporter);  

$message = Swift_Message::newInstance($transporter)
    -&gt;setSubject($subject)
    -&gt;setFrom(array($from_email =&gt; $from))
    -&gt;setTo(array($to_email))
    -&gt;setBody($message);

$mailer-&gt;send($message);

echo " * Message was sent", "\n";
$msg-&gt;delivery_info['channel']-&gt;basic_ack($msg-&gt;delivery_info['delivery_tag']);
</code></pre>

<p>};</p>

<p>$channel->basic_qos(null, 1, null);
$channel->basic_consume(&lsquo;email_queue&rsquo;, &lsquo;&rsquo;, false, false, false, false, $callback);</p>

<p>while(count($channel->callbacks)) {</p>

<pre><code>$channel-&gt;wait();
</code></pre>

<p>}
?>
```</p>

<p>Breaking it down, the first 5 lines of code are basically the same as the one we have on the <code>sender.php</code> file. Then we just output a message saying how we can stop the file from running. We need to run this file from the terminal so to stop it we just hit <code>CTRL + C</code>.</p>

<p>Next we declare a named function. This will be used for processing the message that we passed from the sender. The first thing it does is output that the message was received. Then we use <code>json_decode()</code> to convert the JSON string back to an array.</p>

<p>```
&lt;?php
$callback = function($msg){</p>

<pre><code>echo " * Message received", "\n";
$data = json_decode($msg-&gt;body, true);
</code></pre>

<p>};
?>
```</p>

<p>Next we extract the data and assign them to each of their own variables:</p>

<p><code>
&lt;?php
$from = $data['from'];
$from_email = $data['from_email'];
$to_email = $data['to_email'];
$subject = $data['subject'];
$message = $data['message'];
?&gt;
</code></p>

<p>Next we declare a new transporter to be used by Swiftmailer. This allows us to use a gmail account for sending emails. Declaring a new instance accepts 3 arguments: the host, port and the encryption. Then we set the username and password.</p>

<p>```
&lt;?php
$transporter = Swift_SmtpTransport::newInstance(&lsquo;smtp.gmail.com&rsquo;, 465, &lsquo;ssl&rsquo;)</p>

<pre><code>  -&gt;setUsername('YOUR_GMAIL_EMAIL')
  -&gt;setPassword('YOUR_GMAIL_PASSWORD');
</code></pre>

<p>?>
```</p>

<p>Next we declare a new mailer instance, and supplying the transporter as an argument.</p>

<p><code>
&lt;?php
$mailer = Swift_Mailer::newInstance($transporter);  
?&gt;
</code></p>

<p>Next create a new message, this also takes up the transporter as its argument. We then set the subject, from field, to field, and body of the message.</p>

<p>```
&lt;?php
$message = Swift_Message::newInstance($transporter)</p>

<pre><code>    -&gt;setSubject($subject)
    -&gt;setFrom(array($from_email =&gt; $from))
    -&gt;setTo(array($to_email))
    -&gt;setBody($message);
</code></pre>

<p>?>
```</p>

<p>Finally we send the message and output that the message was sent. The last line basically tells RabbitMQ that the sending of the message has indeed been successful.</p>

<p>```
&lt;?php
$mailer->send($message);
echo &ldquo; * Message was sent&rdquo;, &ldquo;\n&rdquo;;</p>

<p>$msg->delivery_info[&lsquo;channel&rsquo;]&ndash;>basic_ack($msg->delivery_info[&lsquo;delivery_tag&rsquo;]);
?>
```</p>

<h4>Running the program</h4>

<p>You can now run the receiver by going to your terminal and executing the following command:</p>

<p><code>
php receiver.php
</code></p>

<p>Once its running, go to your browser and access the <code>sender.php</code> file. Enter the details of your message and click on send. You&rsquo;re instantly greeted by a &lsquo;Your message was sent!&rsquo; text but if you immediately check your email account its not there yet. If its not there then the queue is still processing it. Check the output displayed on the terminal window where you executed the receiver. You should see a &lsquo;Message was sent&rsquo; output if the email was already sent.</p>

<h3>Conclusion</h3>

<p>RabbitMQ is a nice way for implementing messaging applications such as the one we created in this tutorial. We have barely scratch the surface with this tutorial. I recommend you check out the <a href="http://www.rabbitmq.com/getstarted.html">getting started guides</a> and the <a href="http://www.rabbitmq.com/documentation.html">documentation</a> to learn more.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Datatables with Laravel]]></title>
    <link href="http://anchetawern.github.io/blog/2014/08/10/using-datatables-with-laravel/"/>
    <updated>2014-08-10T16:48:00+08:00</updated>
    <id>http://anchetawern.github.io/blog/2014/08/10/using-datatables-with-laravel</id>
    <content type="html"><![CDATA[<p>In this tutorial I&rsquo;ll be walking you through how you can use datatables in Laravel. But first, let me give you a quick intro on what Datatabes is. <a href="http://datatables.net/">Datatables</a> is basically a jQuery plugin that allows you to add advanced interaction controls to your HTML tables. Things like search, pagination, sorting, and ordering. Datatables allows you to add those kinds of functionality into your tables with minimal code.</p>

<p>In this tutorial were going to be using a Laravel package called <a href="https://github.com/Chumper/Datatable">Chumper</a>. Chumper allows us to easily create Datatables which uses the data returned from a model as its data source.</p>

<p>First thing that you need to do is to add the following in your <code>composer.json</code> file:</p>

<p>```
&ldquo;require&rdquo;: {</p>

<pre><code>"chumper/datatable": "2.*",
</code></pre>

<p>}
```</p>

<p>If you got other packages that you need for your project, just add it on the last part of the <code>require</code> item. Once you&rsquo;re done with that, execute <code>composer update</code> from your terminal to install Chumper.</p>

<p>Once composer finishes installing Chumper, add the service provider for Chumper into the <code>providers</code> array in your <code>app.php</code> file inside the <code>app/config</code> directory of your Laravel installation:</p>

<p><code>
'Chumper\Datatable\DatatableServiceProvider',
</code></p>

<p>Still inside the <code>app.php</code> file, also add the following under the aliases array:</p>

<p><code>
'Datatable' =&gt; 'Chumper\Datatable\Facades\DatatableFacade',
</code></p>

<p>Once that&rsquo;s done, you can now create the main configuration file by executing the following from the terminal:</p>

<p><code>
php artisan config:publish chumper/datatable
</code></p>

<p>The main configuration file is stored under <code>app/config/packages/chumper/datatable/config.php</code> so go ahead and edit that if you want to change the default settings provided by Chumper. Things like the class or ID given to the tables generated can be configured from that file. This is particularly useful if you want to use classes or IDs to style the datatables in a specific way. Other than that the default settings can be used for most cases.</p>

<p>Now that we have configured Chumper, we can now add a route that will return the page where the datatable is displayed in your <code>routes.php</code> file. In the example below, we have the a controller called <code>AdminController</code> and were using the data returned by the <code>users</code> method as a response whenever the <code>users</code> route is accessed via the <code>GET</code> method:</p>

<p><code>php
&lt;?php
Route::get('users', 'AdminController@users');
?&gt;
</code></p>

<p>Next we also need to add the route that will return the data into the client side. By default, Chumper uses the server for processing queries made through the datatable. This means that it only gets the actual data that is needed instead of getting all of the records in the database table that you specify. In the code below, were giving a name of <code>api.users</code> to the <code>api/users</code> route so that we can refer to it later in the controller. The <code>uses</code> keyword allows you to specify a controller action to the route. Its basically the same thing as what we did above but that&rsquo;s the way to do it if you&rsquo;re using named routes.</p>

<p><code>
&lt;?php
Route::get('api/users', array('as' =&gt; 'api.users', 'uses' =&gt; 'AdminController@getUsersDataTable'));
?&gt;
</code></p>

<p>Under your controller, here&rsquo;s the method that returns the page where the datatable is displayed:</p>

<p>```
&lt;?php
public function users(){</p>

<pre><code>$table = Datatable::table()
    -&gt;addColumn('Name', 'Last Login', 'View')
    -&gt;setUrl(route('api.users'))
    -&gt;noScript();

$this-&gt;layout-&gt;content = View::make('admin.users', array('table' =&gt; $table));
</code></pre>

<p>}
?>
```</p>

<p>The code above assumes that you&rsquo;re using <a href="http://laravel.com/docs/templates">Laravel layouts</a>. If you don&rsquo;t know how to use layouts in Laravel, be sure to check out the docs. Breaking the code down, the following code allows you create the datatable. You can add columns to it by using the <code>addColumn</code> method. This method takes up the names that you want to give to the header for each field in the table. The <code>setUrl</code> method allows you to set the route that the datatable will use for processing queries made through it. Earlier we created a route and named it <code>api.users</code> so in the <code>setUrl</code> method all we have to do is to use the <code>route</code> method and then supply the name of the route which is responsible for returning the data for processing the queries. Lastly, we call the <code>noScript()</code> method to specify that we don&rsquo;t want to add the JavaScript code in the response that will be returned.</p>

<p>```
&lt;?php
$table = Datatable::table()</p>

<pre><code>-&gt;addColumn('Name', 'Last Login', 'View')
-&gt;setUrl(route('api.users'))
-&gt;noScript();
</code></pre>

<p>?>
```</p>

<p>Next is the method which processes the queries made through the datatable:</p>

<p>```
&lt;?php
public function getUsersDataTable(){</p>

<pre><code>$query = User::select('name', 'active', 'last_login', 'id')-&gt;get();

return Datatable::collection($query)
    -&gt;addColumn('last_login', function($model){
        return date('M j, Y h:i A', strtotime($model-&gt;last_login));
    })
    -&gt;addColumn('id', function($model){
        return '&lt;a href="http://anchetawern.github.io/users/' . $model-&gt;id . '"&gt;view&lt;/a&gt;';
    })
    -&gt;searchColumns('name', 'last_login')
    -&gt;orderColumns('name', 'last_login')
    -&gt;make();
</code></pre>

<p>}
?>
```</p>

<p>Breaking it down, the code below allows you to specify the fields that you want to use for the response. These are the actual field names in your database table:</p>

<p><code>
&lt;?php
$query = User::select('name', 'last_login', 'id')-&gt;get();
?&gt;
</code></p>

<p>Next, we return the actual data using the <code>collection</code> method in the <code>Datatable</code> class. Well, not actually the <code>Datatable</code> class, since its just the Facade that we used earlier in the <code>app.php</code> file. The <code>collection</code> method requires the result set returned by our query to the users table earlier so we just set that as the argument. After that, we can call the <code>addColumn</code> method to update the presentation of the data returned for that specific field. In the case of the <code>last_login</code> field, its stored in the database as a time stamp which looks like this: <code>2014-07-29 11:37:39</code>. We don&rsquo;t really want to present that to the user like that so we format it using the <code>date</code> method. The first argument is the format that you want. In this case we want something like this: <code>Jul 29, 2014 11:37 AM</code>. Looking at the <a href="http://php.net/manual/en/function.date.php">official docs</a>, we know that we can do that by specifying the following: <code>M j, Y h:i A</code>. The second argument is a unix timestamp. We can convert the raw data that came from the database into a unix timestamp by using the <code>strtotime</code> method, so we do just that. Next is the <code>id</code> field. We don&rsquo;t actually want to display the users id to the user, what we want is to display a link that would lead the user to the page where more details for the user can be viewed. Thus we return an HTML anchor tag which uses the id as one of the component for the actual link.</p>

<p>```
&lt;?php
return Datatable::collection($query)</p>

<pre><code>-&gt;addColumn('last_login', function($model){
    return date('M j, Y h:i A', strtotime($model-&gt;last_login));
})
-&gt;addColumn('id', function($model){
    return '&lt;a href="http://anchetawern.github.io/users/' . $model-&gt;id . '"&gt;view&lt;/a&gt;';
})
</code></pre>

<p>?>
```</p>

<p>Lastly, we can now display the datatable in our view. If you&rsquo;re using <a href="http://getbootstrap.com/">Twitter Bootstrap</a>, it should look similar to this one:</p>

<p>
``` html
@section(&lsquo;content&rsquo;)</p>

<div class="row">
  <div class="col-md-12">
  <h3>Users</h3>
  {{ $table->render() }}
  {{ $table->script() }}
  </div>
</div>


<p>@stop
```
</p>

<p>And don&rsquo;t forget to include the datatables stylesheet and JavaScript file on your views. You can download datatables from <a href="http://datatables.net/">datatables.net</a> or you can just use cdnjs:</p>

<p>```html
<link rel="stylesheet" type="text/css" href="http://anchetawern.github.io//cdnjs.cloudflare.com/ajax/libs/datatables/1.10.4/css/jquery.dataTables.min.css"></p>

<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.4/js/jquery.dataTables.min.js"></script>


<p>```</p>

<p>And yes, datatables depends on jQuery so you also need to include that before including datatables.</p>

<p>Yup! as simple as that! All we have to do is to call the <code>render()</code> method to render the actual datatabase. And then we also call the <code>script()</code> method to render the JavaScript file that would do the talking to the server every time the user interacts with the table.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Getting Started With Zillow API]]></title>
    <link href="http://anchetawern.github.io/blog/2014/03/20/getting-started-with-zillow-api/"/>
    <updated>2014-03-20T14:01:00+08:00</updated>
    <id>http://anchetawern.github.io/blog/2014/03/20/getting-started-with-zillow-api</id>
    <content type="html"><![CDATA[<p>In this tutorial were going to have a quick look at the Zillow API. But before we move on with actually writing some code lets first define what Zillow is. Taken from the <a href="http://www.zillow.com/corp/About.htm">Zillow about page</a> itself:</p>

<p><blockquote><p>Zillow is a home and real estate marketplace dedicated to helping homeowners, home buyers, sellers, renters, real estate agents, mortgage professionals, landlords and property managers find and share vital information about homes, real estate, mortgages and home improvement.</p></blockquote></p>

<p>To sum it up Zillow is a place where you can find useful information on real estate properties that are up for sale or rent.</p>

<!-- more -->


<h4>Getting a Zillow Web Service ID</h4>

<p>In order to start making requests to the Zillow API you must first register an account with them. Registering with zillow is free, all you have to do is visit the <a href="http://www.zillow.com/">zillow homepage</a> and click on the join link. After that just enter all the information that is being asked. Once registered go to the <a href="http://www.zillow.com/webservice/Registration.htm">API registration page</a> and enter the necessary information:</p>

<p><img src="/images/posts/2014-03-20-getting-started-with-zillow-api/api-signup.png" alt="zillow api registration" /></p>

<p>Just check the specific API that you will need for your project, agree to the terms of use then click on the submit button. Zillow will also ask about a sample URL where you will use the API, if you do not have a specific URL in mind you can just place <code>http://localhost</code> or some other URL which you can use for testing purposes.</p>

<p>Once that&rsquo;s done zillow will email you the API details. All you need here is the value for the Zillow Web Services Identification (ZWSID).</p>

<h4>GetSearchResults API</h4>

<p>Now that we have a zillow web service ID its time to test out some of the API methods that are available. First on the list is the <code>GetSearchResults API</code> which you can use to find real estate information for a specific address. Note that an address must be posted first by an owner or an agent in the <a href="http://www.zillow.com/for-sale-by-owner/">Zillow site</a> before it can be viewed.</p>

<p>The URL for requesting search results is <code>http://www.zillow.com/webservice/GetSearchResults.htm</code>.</p>

<p>It requires 3 url encoded arguments to be passed in:</p>

<ul>
<li><strong>zws-id</strong> &ndash; the zillow web service id</li>
<li><strong>address</strong> &ndash; the address of the property to search (e.g. 3799 S Las Vegas Blvd, Las Vegas, NV 89109, United States)</li>
<li><strong>citystatezip</strong> &ndash; the city + state combination or the zip code of the address that you specified in the <code>address</code> field.</li>
</ul>


<p>A successful request will return an XML file containing all the search results. Here&rsquo;s a JSON string representation of the XML file that will be returned:</p>

<p>```json
{</p>

<pre><code>request: {
    address: '',
    citystatezip: ''
},
message: {
    text: '',
    code: ''
},
response: {
    results: {
        result: [
            {
                zpid: '',
                link: {
                    homedetails: '',
                    graphsanddata: '',
                    comparables: ''
                },
                address: {
                    street: '',
                    zipcode: '',
                    city: '',
                    state: '',
                    latitude: '',
                    longitude: ''
                },
                zestimate: {
                    amount: '',
                    last-updated: '',
                    oneWeekChange: {
                        @attributes: {
                            deprecated: ''
                        }
                    },
                    valueChange: '',
                    valuationRange: {
                        low: '',
                        high: ''
                    },
                    percentile: ''
                },
                localRealEstate: {
                    region: {
                        @attributes: {
                            id: '',
                            type: '',
                            name: ''
                        },
                        links: {
                            overview: '',
                            forSaleByOwner: '',
                            forSale: ''
                        }
                    }
                }
            }
        ]
    }
}
</code></pre>

<p>}
```</p>

<p>And no the results doesn&rsquo;t exactly return empty strings for the values of each of the properties. I just did it that way so you can focus on the actual properties that are returned.</p>

<p>Here&rsquo;s an example PHP code that makes a request to the zillow API using <code>file_get_contents</code>. You can also use <code>curl</code> to have the benefit of error handling but to keep things simple lets stick with <code>file_get_contents</code> for this tutorial:</p>

<p>```php
&lt;?php
$zillow_id = &lsquo;xxx&rsquo;; //the zillow web service ID that you got from your email</p>

<p>$search = $<em>GET[&lsquo;address&rsquo;];
$citystate = $</em>GET[&lsquo;citystate&rsquo;];
$address = urlencode($search);
$citystatezip = urlencode($citystate);</p>

<p>$url = &ldquo;<a href="http://www.zillow.com/webservice/GetSearchResults.htm?zws-id=$zillow_id&amp;address=$address&amp;citystatezip=$citystatezip">http://www.zillow.com/webservice/GetSearchResults.htm?zws-id=$zillow_id&amp;address=$address&amp;citystatezip=$citystatezip</a>&rdquo;;</p>

<p>$result = file_get_contents($url);
$data = simplexml_load_string($result);
?>
```</p>

<p>Once the request is completed you can just access individual properties using the arrow notation. In the example below were accessing the <code>zpid</code> property:</p>

<p><code>
&lt;?php
echo $data-&gt;response-&gt;results-&gt;result[0]-&gt;zpid;
?&gt;
</code></p>

<p>But what happens when we enter an address which doesn&rsquo;t exist in the zillow database? For that you can check the value for the <code>message.code</code>:</p>

<p><code>
&lt;?php
$code = $data-&gt;message-&gt;code;
?&gt;
</code></p>

<p>This contains a 1-3 digit number. <code>0</code> basically means that the request was successful and that there are results that are returned. <code>507</code> or <code>508</code> means that there&rsquo;s no exact match for the inputted address. There are a bunch of other error codes which you can use so check out the messages and codes section in the <a href="http://www.zillow.com/howto/api/GetSearchResults.htm">search results api page</a> for more information.</p>

<p>For more information regarding the search results API check out <a href="http://www.zillow.com/howto/api/GetSearchResults.htm">this page</a></p>

<h4>GetZestimate API</h4>

<p>Another API Method that we can use is the <code>GetZestimate</code>. This returns information regarding the zestimate of a specific property. A Zestimate is Zillow&rsquo;s estimated market value, computed using a proprietary formula. You can use the <code>GetZestimate</code> method by making a request to this URL: <code>http://www.zillow.com/webservice/GetZestimate.htm</code>.</p>

<p>The <code>GetZestimate</code> method only requires 2 arguments: the <code>zws-id</code> and the <code>zpid</code>. Of this 2 arguments the <code>zpid</code> is of interest since we didn&rsquo;t use it in the previous method. The <code>zpid</code> is basically a unique ID assigned by zillow to a specific property.</p>

<p>If you might have noticed earlier the <code>SearchResults</code> method already returns some zestimate data:</p>

<p>```json
zestimate: {</p>

<pre><code>amount: '',
last-updated: '',
oneWeekChange: {
    @attributes: {
        deprecated: ''
    }
},
valueChange: '',
valuationRange: {
    low: '',
    high: ''
},
percentile: ''
</code></pre>

<p>}
```</p>

<p>You can pretty much use this one if you don&rsquo;t need detailed information about a specific zestimate of a property. But if need more detailed information the <code>GetZestimate</code> method is the one that you need to use. Here&rsquo;s the JSON string representation of the result that it returns:</p>

<p>```
{</p>

<pre><code>request: {
    zpid: ''
},
message: {
   text: '',
   code: ''
},
response: {
    zpid: '',
    links: {
        homedetails: '',
        graphsanddata: '',
        mapthishome: '',
        comparables: ''
    },
    address: {
        street: '',
        zipcode: '',
        city: '',
        state: '',
        latitude: '',
        longitude: ''
    },
    zestimate: {
        amount: '',
        last-update: '',
        oneWeekChange: '',
        valueChange: '',
        valuationRange: {
            low: '',
            high: ''
        },
        percentile: ''
    },
    localRealEstate: {
        region: {
            links: {
                overview: '',
                forSaleByOwner: '',
                forSale
            }
        }
    },
    regions: {
        zipcode-id: '',
        city-id: '',
        county-id: '',
        state-id: ''
    }
}
</code></pre>

<p>}
```</p>

<p>The one caveat about the <code>GetZestimate</code> method is that it cannot be used without having information on the <code>zpid</code>. And you can only get the <code>zpid</code> with the <code>GetSearchResults</code> method so the <code>GetZestimate</code> method is always used in tandem with the <code>GetSearchResults</code> method unless you&rsquo;re saving <code>zpid</code>&rsquo;s in your database.</p>

<p>If you want to know more about the <code>GetZestimate</code> method check out the <a href="http://www.zillow.com/howto/api/GetZestimate.htm">documentation</a></p>

<h4>GetChart</h4>

<p>The last method that I&rsquo;m going to talk about in this tutorial is the <code>GetChart</code> method. You can use the <code>GetChart</code> method to get a URL to an image which shows the historical zestimates for a specific property. You can make a request to this method by using this URL: <code>http://www.zillow.com/webservice/GetChart.htm</code></p>

<p>The <code>GetChart</code> method requires the following argument to be passed in:</p>

<ul>
<li><code>zws-id</code></li>
<li><code>zpid</code> &ndash; the unique ID assigned by zillow to the specific property</li>
<li><code>unit-type</code> &ndash; you can either use <code>dollar</code> or <code>percent</code> as the value. This is basically use for specifying whether to display the dollar changed or the percent changed of a specific property</li>
<li><code>height</code> &ndash; the height of the image to return in pixels</li>
<li><code>width</code> &ndash; the width of the image to return in pixels</li>
</ul>


<p>You can pretty much guess the <code>unit-type</code> that was used for this image. Yep that&rsquo;s right its in dollars. So the image above is basically showing that the value for the specific property went up from 96,000 dollars to 104,000 dollars over a period of about one year. You can actually specify this value by passing in the <code>chartDuration</code> argument. Then you can have values like <code>1year</code>, <code>2years</code> or <code>10years</code>. If you don&rsquo;t specify anything it defaults to &lsquo;1year&rsquo;.</p>

<p>For more information regarding the <code>GetChart</code> method check out its <a href="http://www.zillow.com/howto/api/GetChart.htm">documentation</a>.</p>

<h3>Conclusion</h3>

<p>That&rsquo;s it! Like with any other getting started guide we&rsquo;ve only scratched the surface with this tutorial. There&rsquo;s a lot more that you can do with Zillow API so be sure to check out the resources below to learn more.</p>

<h3>Resources</h3>

<ul>
<li><a href="http://www.zillow.com/howto/api/APIOverview.htm">Zillow API Documentation</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
