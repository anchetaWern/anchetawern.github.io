
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Building a User Management System in Laravel - Wern Ancheta</title>
  <meta name="author" content="Wern Ancheta">

  
  <meta name="description" content="Note: The code that were used in this tutorial is for an older version of Laravel (version 3). Some of the code might still be applicable in the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://anchetawern.github.io/blog/2012/12/17/building-a-user-management-system-in-laravel">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Wern Ancheta" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/javascripts/libs/fancybox/source/jquery.fancybox.css">

<script src="/javascripts/contact.js"></script>

  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Wern Ancheta</a></h1>
  
    <h2>Adventures in Web Development.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:anchetawern.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/aboutme">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Building a User Management System in Laravel</h1>
    
    
      <p class="meta">
        








  



  
<time datetime="2012-12-17T14:03:00+08:00" pubdate data-updated="true">Dec 17<span>th</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><blockquote><p>Note: The code that were used in this tutorial is for an older version of Laravel (version 3). Some of the code might still be applicable in the current version of Laravel. But just to be sure, check out the official Laravel documentation at laravel.com/docs for the corresponding code of the codes that you find in here.</p></blockquote>


<p>There&rsquo;s no shortage of good resources for learning laravel.
So instead of the usual introductory tutorial were just gonna learn Laravel by building
a project from scratch and that&rsquo;s gonna be a User Management System.</p>

<p>I don&rsquo;t know if my definition of a User Management System is correct
but here&rsquo;s my idea of what&rsquo;s it&rsquo;s capable of doing:</p>

<ul>
<li>Register Roles</li>
<li>Register Users</li>
<li>Update Users</li>
<li>Disable Users</li>
<li>Update Transactions which can be performed by each role</li>
<li>Login Users</li>
<li>Limit Transactions that can be performed by each role</li>
</ul>


<p>Yup! that&rsquo;s a lot so you might want to go ahead and grab some coffee and some snacks
before we start.</p>

<!--More-->


<p>The version of Laravel that were gonna use is Laravel v3.2.1 so if you&rsquo;re reading this and version 4 is already out then you might want to use that version instead. There maybe some parts which won&rsquo;t work because of changes in the syntax
but the Laravel Documentation is always updated so you might want to check it out if some of the code below won&rsquo;t work
as you expected.</p>

<p>If you haven&rsquo;t downloaded Laravel yet now is the time to do so. Just go to <a href="http://laravel.com/">Laravel.com</a> and click the big download button.</p>

<h3>Project Setup</h3>

<p>After extracting the laravel zip file the root of your project should now look like this:</p>

<p><img src="/images/posts/building_user_management_using_laravel/project_structure.jpg" alt="project structure" /></p>

<p>For this project we will be using the following to make our life easier:</p>

<ul>
<li><a href="http://jquery.com">jQuery</a></li>
<li><a href="http://foundation.zurb.com">Foundation</a></li>
<li><a href="http://jqueryui.com">jQuery UI</a></li>
</ul>


<p>Project assets are normally stored in the <code>public</code> directory in laravel.
Go ahead and navigate to that directory and add the following folders if they not already exists.</p>

<ul>
<li><strong>js</strong> &ndash; javascript goodness (jquery)</li>
<li><strong>css</strong> &ndash; stylesheets (main.css)</li>
<li><strong>img</strong> &ndash; system images (logo)</li>
<li><strong>assets</strong> &ndash; image sprites, icons (foundation zurb icons)</li>
<li><strong>libs</strong> &ndash; css frameworks (foundation, jquery ui)</li>
</ul>


<p>Once you have placed all the project assets in their directories.
Go ahead and add a constructor method on the base controller.
The base controller is located at <code>application/controllers/base.php</code> The base controller is extended by every controller
that you create in laravel so its constructor is the perfect place to add code that automatically runs on every
page in your application. In this case were just going to use it to add our project assets.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//styles</span>
</span><span class='line'>  <span class="nx">Asset</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;main_style&#39;</span><span class="p">,</span> <span class="s1">&#39;css/main.css&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">Asset</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;jquery&#39;</span><span class="p">,</span> <span class="s1">&#39;js/jquery.js&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">Asset</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;foundation_style&#39;</span><span class="p">,</span> <span class="s1">&#39;libs/foundation/stylesheets/foundation.min.css&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">Asset</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;foundation_icons&#39;</span><span class="p">,</span> <span class="s1">&#39;assets/foundation_icons_general/stylesheets/general_foundicons.css&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">Asset</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;jqueryui_style&#39;</span><span class="p">,</span> <span class="s1">&#39;libs/jquery-ui/css/smoothness/jquery-ui-1.9.1.custom.min.css&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">Asset</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;datatables_style&#39;</span><span class="p">,</span> <span class="s1">&#39;libs/datatables/media/css/jquery.dataTables.css&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//scripts</span>
</span><span class='line'>  <span class="nx">Asset</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;foundation_script&#39;</span><span class="p">,</span> <span class="s1">&#39;libs/foundation/javascripts/foundation.min.js&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">Asset</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;jqueryui_script&#39;</span><span class="p">,</span> <span class="s1">&#39;libs/jquery-ui/js/jquery-ui-1.9.1.custom.min.js&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">Asset</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;datatables_script&#39;</span><span class="p">,</span> <span class="s1">&#39;libs/datatables/media/js/jquery.dataTables.js&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">Asset</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;mustache_script&#39;</span><span class="p">,</span> <span class="s1">&#39;js/mustache.js&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">Asset</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;main_script&#39;</span><span class="p">,</span> <span class="s1">&#39;js/main.js&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"> </span>
</span></code></pre></td></tr></table></div></figure>


<h3>Laravel Generator</h3>

<p>To make your life easier you might want to use <a href="https://github.com/JeffreyWay/Laravel-Generator">Laravel Generator</a> by Jeffrey Way.
It&rsquo;s use to generate views, models, controllers, assets, tests and migrations easier.</p>

<p>Just grab the <code>generate.php</code> file from the github page I linked to earlier.
Then paste it to the <code>application\tasks</code> folder.</p>

<h3>Configuration</h3>

<p>For every framework there&rsquo;s always something you need to configure and
for that you need to go to <code>application/config</code> directory and
open up the <code>application.php</code> file. Remove the default value for the key or if you want
just type in some 32 characters of random gibberish. The key is used for encryption and cookie stuff. Based on my understanding its like the salt for a password used to make it more difficult for a hacker to crack it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">&#39;key&#39; =&gt; &#39;&#39; </span>
</span></code></pre></td></tr></table></div></figure>


<p>If you don&rsquo;t want to type the key by hand there&rsquo;s the <code>artisan</code> tool to the rescue, just execute the following command
while you&rsquo;re in your projects root directory to generate the random gibberish for you.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">php artisan key:generate</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next thing you need to configure is the <code>profiler</code>. Just set it to true.
This will give you an idea how long it took the page to execute, or how many queries
were executed, what queries were executed.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">profiler&#39; =&gt; true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next open up the <code>database.php</code> file. Make sure that the default is set to mysql:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">&#39;default&#39; =&gt; &#39;mysql&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then enter your database information:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="s1">&#39;mysql&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>  <span class="s1">&#39;driver&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;host&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;database&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;rpt&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;charset&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;prefix&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Next open up the <code>session.php</code> file. Set the driver to file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">&#39;driver&#39; =&gt; &#39;file&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The driver is the means of storing a session. You can also use cookies, database, memcached, apc or redis.</p>

<p>Set the <code>lifetime</code> of the session to whatever feels right.
Since were building a user management system you want to keep it to a minimum.
This means that the session will automatically be destroyed after 15 minutes of being idle.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">&#39;lifetime&#39; =&gt; 15</span>
</span></code></pre></td></tr></table></div></figure>


<p>You may also want to set <code>expire_on_close</code> to <code>true</code> for extra security.
This will automatically expire the session when the user closes the browser window.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">&#39;expire_on_close&#39; =&gt; true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next open up the <code>auth.php</code> file. Were doing this configuration in advance since we haven&rsquo;t created the users table yet.
Go ahead and read up the text in the database section to create the users table then go back to this one.
Otherwise just continue with this and change the field names in the users table later on.</p>

<p>The <code>auth.php</code> file stores the configuration for the default user authentication functionality that is available on laravel.</p>

<p>Change the values for <code>driver</code> , <code>username</code> , <code>password</code> and <code>model</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">&#39;driver&#39; =&gt; &#39;eloquent&#39;,</span>
</span><span class='line'><span class="x">&#39;username&#39; =&gt; &#39;username&#39;,</span>
</span><span class='line'><span class="x">&#39;password&#39; =&gt; &#39;hashed_password&#39;,</span>
</span><span class='line'><span class="x">&#39;model&#39; =&gt; &#39;User&#39;,</span>
</span></code></pre></td></tr></table></div></figure>


<p>The driver can either be <code>fluent</code> or <code>eloquent</code> but were using <code>eloquent</code> to have a flexibility in naming the primary key. Since the default name for primary key field is <code>id</code> and if we have something like <code>user_id</code> as a field name
then it won&rsquo;t work. The values for <code>username</code> and <code>password</code> are the field names of your username and password fields in your users table. The model is the name of the model for the <code>users</code> table.</p>

<h3>Database</h3>

<p>It&rsquo;s good practice to use migrations to track the changes in the database.
Database migrations is like a version control for databases.
In order to use database migrations you first have to create the table that will be used
by laravel to track the migrations that are created. To do that execute the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">php artisan migrate:install</span>
</span></code></pre></td></tr></table></div></figure>


<p>The command will create a <code>laravel_migrations</code> table in your database.</p>

<p><img src="/images/posts/building_user_management_using_laravel/laravel_migrations.jpg" alt="laravel migrations" /></p>

<p>Once that&rsquo;s done create the migration file that will create the users table.
The syntax for generating migrations would be:</p>

<ul>
<li>what the migration does (Eg. create, update, delete)</li>
<li>what&rsquo;s the name of the table or field (Eg. users, username, roles)</li>
<li>what will be generated (Eg. table, field)</li>
</ul>


<p><strong>Users Table</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">php artisan migrate:make create_users_table</span>
</span></code></pre></td></tr></table></div></figure>


<p>The command above will generate a file in <code>application/migrations</code> directory
which will have a filename like <code>2012_11_25_004329_create_table_users.php</code>  composed of the timestamp in which the file was generated plus the actual name of the migration. If you open it up it will look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Create_Users_Table</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>up()</code> method contains what you want to do to the database when you execute the migration.
It will normally contain an array of fields to be created and some default values to be inserted on the table.</p>

<p>The <code>down()</code> method will contain what you want to do when you rollback the migration.</p>

<p>Open up the migration file for creating the users table and add the following code on the <code>up()</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;firstname&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;middlename&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;lastname&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">&#39;department_id&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;role_id&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="s1">&#39;hashed_password&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>You can also insert some default data on the table if you want:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span>
</span><span class='line'>  <span class="k">array</span><span class="p">(</span>
</span><span class='line'>      <span class="s1">&#39;firstname&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Hibari&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;middlename&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Neo&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;lastname&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Kyoya&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;department_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;role_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
</span><span class='line'>      <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;hkyoya&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;hashed_password&#39;</span> <span class="o">=&gt;</span> <span class="nx">Hash</span><span class="o">:</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;somepassword&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
</span><span class='line'>  <span class="p">)</span>
</span><span class='line'><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>By now you should have grok database migrations. Let&rsquo;s move on to the next level by generating migrations using the Laravel generator tool:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">php artisan generate:migration create_departments_table department:string</span>
</span><span class='line'>
</span><span class='line'><span class="x">php artisan generate:migration create_roles_table department_id:integer role:string</span>
</span><span class='line'>
</span><span class='line'><span class="x">php artisan generate:migration create_transactions_table department_id:integer main_menu:string menu_text:string address:string</span>
</span><span class='line'>
</span><span class='line'><span class="x">php artisan generate:migration create_rolestransactions_table role_id:integer transaction_id:integer status:integer</span>
</span><span class='line'>
</span><span class='line'><span class="x">php artisan generate:migration create_userlogs_table user_id:integer user:string department:string transaction:string dateandtime:timestamp</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you open up the files that were generated you will see that there&rsquo;s a method called <code>timestamps()</code>.
This creates two additional fields: created_at and updated_at.
In most cases you don&rsquo;t need those, you can go ahead and remove those for each migration file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">$table-&gt;timestamps();</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Next, execute the migration to create the tables in the database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">php artisan migrate</span>
</span></code></pre></td></tr></table></div></figure>


<p>Executing the above command will create the following tables in your database:</p>

<ul>
<li><strong>users</strong> &ndash; stores user login information</li>
<li><strong>departments</strong> &ndash; stores departments, offices or sections</li>
<li><strong>roles</strong> &ndash; stores the roles or user groups for each department. (Eg. collector in the treasury department)</li>
<li><strong>rolestransactions</strong> &ndash; stores the status of the transactions that can be performed by each role</li>
<li><strong>transactions</strong> &ndash; stores all the transactions that can be performed in the application</li>
</ul>


<p>If for some reason you have made a mistake, you can execute <code>php artisan migrate:rollback</code> to
execute the <code>down()</code> method in the migrate file.
Once that&rsquo;s executed you can go ahead and make the necessary changes on the migration file then execute <code>php artisan migrate</code> again to commit the changes to the database.</p>

<p>Once the tables are added into the database let&rsquo;s add the relationships between those tables.
This time we will just use the default functionality for creating migrations in laravel and not the laravel generator.
Based on the documentation of laravel generator I think there&rsquo;s still no way of specifying the relationships for each table.
But we don&rsquo;t know maybe by the time you&rsquo;re reading this Jeffrey Way has already added that functionality so you might want to use it if its already available to save some time.</p>

<p>Execute the following commands to generate migrations for adding relationships for each table:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">php artisan migrate:make add_foreignkeys_to_users_table</span>
</span><span class='line'>
</span><span class='line'><span class="x">php artisan migrate:makeadd_foreignkeys_to_roles_table</span>
</span><span class='line'>
</span><span class='line'><span class="x">php artisan migrate:makeadd_foreignkeys_to_transactions_table</span>
</span><span class='line'>
</span><span class='line'><span class="x">php artisan migrate:make add_foreignkeys_to_rolestransactions_table</span>
</span></code></pre></td></tr></table></div></figure>


<p>Go ahead and open up the files that were generated.
For this one I&rsquo;ll only show you how to do the first one then you&rsquo;ll have to do the rest
since the process is basically the same.</p>

<p>The migration file for adding foreign keys to the users table will look like this
on the first time you open it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Add_Foreignkeys_To_Users_Table</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="sd">/**</span>
</span><span class='line'><span class="sd">  * Make changes to the database.</span>
</span><span class='line'><span class="sd">  *</span>
</span><span class='line'><span class="sd">  * @return void</span>
</span><span class='line'><span class="sd">  */</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="sd">/**</span>
</span><span class='line'><span class="sd">  * Revert the changes to the database.</span>
</span><span class='line'><span class="sd">  *</span>
</span><span class='line'><span class="sd">  * @return void</span>
</span><span class='line'><span class="sd">  */</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Add these code to the <code>up()</code> method. This adds a foreign key and index to the <code>department_id</code> and <code>role_id</code> fields:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">Schema::table(&#39;users&#39;, function($table) {</span>
</span><span class='line'><span class="x">  $table-&gt;foreign(&#39;department_id&#39;)-&gt;references(&#39;id&#39;)-&gt;on(&#39;departments&#39;);</span>
</span><span class='line'><span class="x">  $table-&gt;foreign(&#39;role_id&#39;)-&gt;references(&#39;id&#39;)-&gt;on(&#39;roles&#39;);</span>
</span><span class='line'><span class="x">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then on the <code>down()</code> method we just have to drop those indexes that were created:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$table</span><span class="p">){</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">drop_index</span><span class="p">(</span><span class="s1">&#39;users_department_id_foreign&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">drop_index</span><span class="p">(</span><span class="s1">&#39;users_role_id_foreign&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">drop_foreign</span><span class="p">(</span><span class="s1">&#39;users_department_id_foreign&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">drop_foreign</span><span class="p">(</span><span class="s1">&#39;users_role_id_foreign&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>The naming convention used by laravel (or maybe its the default for mysql) is:</p>

<ul>
<li>table name (Eg. users)</li>
<li>field name (Eg. department_id)</li>
<li>key type (Eg. foreign)</li>
</ul>


<p>To be separated by underscores so if you have a table named <code>users</code> and you want to drop
the foreign key and index on the <code>department_id</code> field then the name of the index would be: <code>users_department_id_foreign</code>.</p>

<p>Finally execute the command to commit the migrations into the database.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">php artisan migrate</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Building the Project</h3>

<p>Were finally in the fun part. First let&rsquo;s add the main styling.
Normally this would reside in the <code>public/css</code> directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.pointer</span><span class="p">{</span>
</span><span class='line'>  <span class="k">cursor</span><span class="o">:</span> <span class="k">pointer</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.pointer</span> <span class="nt">a</span><span class="p">{</span>
</span><span class='line'>  <span class="k">color</span><span class="o">:</span> <span class="m">#333</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nt">footer</span><span class="p">{</span>
</span><span class='line'>  <span class="k">margin-top</span><span class="o">:</span> <span class="m">20px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">text-align</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.transactions</span> <span class="nt">li</span><span class="p">{</span>
</span><span class='line'>  <span class="k">list-style</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nt">select</span><span class="p">{</span>
</span><span class='line'>  <span class="k">height</span><span class="o">:</span> <span class="m">32px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Main Script</h4>

<p>Then the main script. This normally resides on <code>public/scripts</code> directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//common script for every page which has text input and datepickers</span>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.datepicker&quot;</span><span class="p">).</span><span class="nx">datepicker</span><span class="p">({</span> <span class="nx">dateFormat</span><span class="o">:</span> <span class="s1">&#39;yy-mm-dd&#39;</span> <span class="p">});</span>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input[type=text]&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;autocomplete&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;input[type=text]:first&#39;</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//common script for create user and update user</span>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#department&quot;</span><span class="p">).</span><span class="nx">blur</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">department</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#role&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#role&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="nx">department</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Public Template</h4>

<p>Inside the <code>application/views</code> folder.
Generate the template for the public view using the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">generate</span><span class="o">:</span><span class="nx">view</span> <span class="kr">public</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will generate a file called <code>public.blade.php</code>.
By default the laravel generator automatically uses <code>.blade</code> as a file extension so that you can use whatever syntactic sugar it offers (no ugly php opening and closing tags, sweet!).</p>

<p>This is like the <code>header.php</code> that most of us are familiar with when we first started with PHP
in which we include all the common elements to be used on all pages like system-wide scripts, styling and header.</p>

<p>Note that were using blade in here so instead of the single curly brace pair <code>{}</code>.
You have to use double curly brace pair. There&rsquo;s an issue with maruku that&rsquo;s why I can only
put the single curly brace pair. Remember to replace the single curly brace pair <code>{}</code> with a double curly brace pair whenever you see them in the examples to follow.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;title&gt;</span>UMS<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>        {Asset::styles()}
</span><span class='line'>    <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body&gt;</span>
</span><span class='line'>          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;twelve columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">&quot;top-bar&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>              <span class="c">&lt;!-- Title Area --&gt;</span>
</span><span class='line'>              <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;{URL::to_asset(&#39;img/umslogo.png&#39;)}&quot;</span> <span class="na">alt=</span><span class="s">&quot;ums_logo&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>              <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;h1&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    UMS
</span><span class='line'>                  <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>              <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;toggle-topbar&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/nav&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>        
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          @yield(&#39;content&#39;)
</span><span class='line'>          <span class="nt">&lt;footer&gt;</span>
</span><span class='line'>               <span class="nt">&lt;p&gt;</span><span class="ni">&amp;copy;</span> UMS 2012<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/footer&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- /container --&gt;</span>
</span><span class='line'>      {Asset::scripts()}
</span><span class='line'>    <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here are some of the methods that we&rsquo;ve used:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="o">@</span><span class="nx">yield</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span> <span class="c1">//yields a particular section defined from a page</span>
</span><span class='line'><span class="p">{</span><span class="nx">URL</span><span class="o">::</span><span class="na">to_asset</span><span class="p">(</span><span class="s1">&#39;img/umslogo.png&#39;</span><span class="p">)}</span> <span class="c1">//includes the application logo</span>
</span><span class='line'><span class="p">{</span><span class="nx">Asset</span><span class="o">::</span><span class="na">styles</span><span class="p">()}</span> <span class="c1">//includes the stylesheets that we have added earlier on the base controller</span>
</span><span class='line'><span class="p">{</span><span class="nx">Asset</span><span class="o">::</span><span class="na">scripts</span><span class="p">()}</span> <span class="c1">//includes the scripts that we have added earlier on the base controller</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>The only thing to remember when you&rsquo;re using these methods is that their root is the public directory of your project.</p>

<h4>Login View</h4>

<p>Next is the login page. The login page will inherit from the public template that we have just created.
The magic keyword for inheriting what&rsquo;s on a specific template is <code>@layout('name_of_the_template')</code>.</p>

<p>Another magic keyword that we have used below is <code>@section</code> which basically lets you define a section that you want to be rendered in the template. That&rsquo;s what the <code>@yield('content')</code> in the template is used for, to render the specific section that you have defined in a specific page.</p>

<p>We also have <code>@render('errors')</code> so this means that we can also render sections inside a section in laravel (How cool is that?).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>@layout(&#39;public&#39;)
</span><span class='line'>
</span><span class='line'>@section(&#39;content&#39;)
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;twelve columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h5&gt;</span>Login<span class="nt">&lt;/h5&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;login_container&quot;</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  @render(&#39;errors&#39;)
</span><span class='line'>  <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;five columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;seven columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;success medium button&quot;</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/button&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;/form&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>@endsection
</span></code></pre></td></tr></table></div></figure>


<h4>Error View</h4>

<p>Create another view using the Laravel generator and name it <code>errors</code>.
This view is what we will be using to display form errors (mostly form validation errors).</p>

<p>This can display both form validation errors and custom form errors that you want your users to see.
Form validation errors that Laravel produces are usually objects so we&rsquo;ll have to loop through those.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;nine columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    @if($errors-&gt;messages) //this is pass through: with_errors($validation)
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;alert-box alert&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      @foreach($errors-&gt;messages as $e)
</span><span class='line'>        <span class="nt">&lt;li&gt;</span> {$e[0]} <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>      @endforeach
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span> <span class="na">class=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/a&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    @endif
</span><span class='line'>    <span class="cp">&lt;?php //&lt;--How I wish I could remove this</span>
</span><span class='line'><span class="cp">    $error = Session::get(&#39;error&#39;); //this is pass through: with(&#39;key&#39;, &#39;value&#39;) on form redirect</span>
</span><span class='line'><span class="cp">    //and this--&gt; ?&gt;</span>
</span><span class='line'>    @if(!empty($error))
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;alert-box alert&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li&gt;</span>{$error}<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    @endif
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Success View</h4>

<p>If we have a separate view for errors then there must also be a view for success right?
Just call it <code>success</code> or whatever. Here it is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;?php </span>
</span><span class='line'><span class="cp">$success_message = Session::get(&#39;success_message&#39;);</span>
</span><span class='line'><span class="cp">?&gt;</span>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;nine columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      @if(!empty($success_message))
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;alert-box success&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          {$success_message}
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span> <span class="na">class=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/a&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    @endif
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ve already setup the <code>session</code> and the <code>auth</code> earlier so were pretty much ready to write the code that will process user login.
Go ahead and create a new controller called <code>login</code> and make it restful.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>php artisan generate:controller login restful
</span></code></pre></td></tr></table></div></figure>


<h4>Default Controllers</h4>

<p>I haven&rsquo;t told you about how are Laravel controllers by default so before you wrap your mind
about restful controllers I&rsquo;ll talk a little about default controllers.</p>

<p>By default controllers in Laravel has a prefix of <code>action_</code> which indicates that they are used to render a specific view and pass data into it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Login_Controller</span> <span class="k">extends</span> <span class="nx">Base_Controller</span><span class="p">{</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Laravel controllers normally extend the <code>base controller</code> in which we specified the projects assets earlier. The naming convention would be <code>Name_of_the_controller</code> + <code>_Controller</code>. Where the name of the controller normally starts with a capital letter. The filename should be the same with name of the controller.</p>

<p>Back to the <code>action_</code> thingy. If you want a method to render a specific view then it should be a public method with the prefix of <code>action_</code>.</p>

<p>For example if you want the index or the <code>public/login</code> page to accessible in the browser then you should name it like the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Login_Controller</span> <span class="k">extends</span> <span class="nx">Base_Controller</span><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">function</span> <span class="nf">action_index</span><span class="p">(){</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span> <span class="c1">//renders the login.blade.php located in the root of the view folder</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>If your method isn&rsquo;t gonna render a view and its just going to perform some computations or database related stuff in your controller then just make it into a private method.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">private</span> <span class="k">function</span> <span class="nf">compute_stuff</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Then you can just access it in your controller like.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">action_index</span><span class="p">(){</span>
</span><span class='line'>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">compute_stuff</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h4>Restful Controllers</h4>

<p>Going back to restful controllers, laravel generator usually generates something like this if you haven&rsquo;t specified some of the methods.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Login_Controller</span> <span class="k">extends</span> <span class="nx">Base_Controller</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="nv">$restful</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>To specify some methods, just add the method name right after the name of the controller.
In this case the name of the controller is <code>login</code> and the method name is <code>index</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">php artisan generate:controller login index restful</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you have executed the command above then your controller will look like this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Login_Controller</span> <span class="k">extends</span> <span class="nx">Base_Controller</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="nv">$restful</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">function</span> <span class="nf">get_index</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x">      </span>
</span></code></pre></td></tr></table></div></figure>


<p>Restful methods generally has these prefix:</p>

<ul>
<li><strong>get</strong> &ndash; when requesting a specific page (Eg. login/index)</li>
<li><strong>post</strong> &ndash; when submitting data through a form</li>
<li><strong>put</strong> &ndash; when updating data</li>
<li><strong>delete</strong> &ndash; when deleting data</li>
</ul>


<p>Only the first two can materialize (sorry couldn&rsquo;t think of a better word, peace grammar natzis) on a browser. But the idea is that methods which are used to render a specific view will have <code>get_</code> as its prefix.
And methods which processes or validates a form will have <code>post_</code> as its prefix.</p>

<h3>Login Controller</h3>

<p>Ok back with the controller. For the index just like with any other PHP framework that you might have used before, the index method is the default method for a controller.
This means that you don&rsquo;t have to type in <code>login/index</code> to access what the index method has to return.
In this case were just rendering the login view that we created earlier.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">get_index</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Create another method called <code>post_index</code> this will be executed everytime the login form is submitted.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">post_index</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h4>Getting Inputs</h4>

<p>Inside the method we&rsquo;ll first have to get what the user has inputted in the form.
Laravel allows us to do that using the <code>Input::get('field_name')</code> method
where the <code>field_name</code> is the name of the input field.<br/>
There&rsquo;s also the <code>input::all()</code> method which gets all the data inputted in the form.
It would be nice if we could just use that but we need to hash the password before saving it to the database that&rsquo;s why we need to get those fields separately.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">$username = Input::get(&#39;username&#39;);</span>
</span><span class='line'><span class="x">$password = Input::get(&#39;password&#39;); </span>
</span><span class='line'><span class="x">$user_details = Input::all(); //Input::all() gets all the data inputted in the form</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Form Validation</h4>

<p>Next we have to specify the validation rules for each field.
Laravel still uses the name attribute of the input field for this.</p>

<p>For both fields were using the same rules which is <code>required</code> this is the only rule we need since this is just a login form.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">$rules = array(&#39;username&#39; =&gt; &#39;required&#39;, &#39;password&#39; =&gt; &#39;required&#39;);</span>
</span></code></pre></td></tr></table></div></figure>


<p>It would be nice if Laravel allows us to specify common validation rules for each field.
Something like.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">$rules = array(Input::all() =&gt; &#39;required&#39;);</span>
</span></code></pre></td></tr></table></div></figure>


<p>But that isn&rsquo;t possible yet, maybe in future versions.</p>

<p>After that just call <code>Validator::make()</code> to create an instance of the validator class.
From there you can just call the <code>fails()</code> or <code>passes()</code> method to check if
the validation failed or suceeded.</p>

<p>If the validation failed all we have to do is to redirect to the login page
passing in the validation instance using the <code>with_errors()</code> method.
This can then be accessed from the error view that we created earlier:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nv">$validation</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nv">$user_details</span><span class="p">,</span> <span class="nv">$rules</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">fails</span><span class="p">()){</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with_errors</span><span class="p">(</span><span class="nv">$validation</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>If the validation suceeded then we will try to login the user.
We can do that by using the <code>attempt()</code> method from the <code>Auth</code> class in Laravel.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="na">attempt</span><span class="p">(</span><span class="nv">$user_details</span><span class="p">)){</span> <span class="c1">//attempt to login the user</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="na">check</span><span class="p">()){</span> <span class="c1">//check if the user is already logged in</span>
</span><span class='line'>      <span class="nv">$user_id</span> <span class="o">=</span> <span class="nx">Auth</span><span class="o">::</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//get user data</span>
</span><span class='line'>      <span class="nv">$user</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
</span><span class='line'>              <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$user_id</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">first</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;department_id&#39;</span><span class="p">,</span> <span class="s1">&#39;role_id&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">status</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nv">$status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span> <span class="c1">//check if user account is enabled</span>
</span><span class='line'>          <span class="nv">$department_id</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">department_id</span><span class="p">;</span>
</span><span class='line'>          <span class="nv">$role_id</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">role_id</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">//save user details into session</span>
</span><span class='line'>          <span class="nx">Session</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;department_id&#39;</span><span class="p">,</span> <span class="nv">$department_id</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">Session</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;role_id&#39;</span><span class="p">,</span> <span class="nv">$role_id</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">Session</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;current_user&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">Session</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;current_user_id&#39;</span><span class="p">,</span> <span class="nv">$user_id</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">//the departments available in the system</span>
</span><span class='line'>          <span class="nv">$departments</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="s1">&#39;marketing&#39;</span><span class="p">,</span> <span class="s1">&#39;defense&#39;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">//redirect user to his departments homepage</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="nv">$departments</span><span class="p">[</span><span class="nv">$department_id</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;/home&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="c1">//if user account is disabled</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)</span>
</span><span class='line'>              <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Disabled users cannot login&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h3>User Management</h3>

<p>Now that were done with the login we can now proceed with the main meat of this project: the user management.</p>

<h4>Main Template</h4>

<p>First let&rsquo;s create the main template to be used on all pages.
It&rsquo;s basically the same with the public template that we created earlier
the only difference is the navigation section.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;title&gt;</span>UMS<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>        {Asset::styles()}
</span><span class='line'>    <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;twelve columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">&quot;top-bar&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>                <span class="c">&lt;!-- Title Area --&gt;</span>
</span><span class='line'>                <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;{URL::to_asset(&#39;img/umslogo.png&#39;)}&quot;</span> <span class="na">alt=</span><span class="s">&quot;ums_logo&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>                <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;h1&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                      UMS
</span><span class='line'>                    <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>                <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;toggle-topbar&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>
</span><span class='line'>              <span class="nt">&lt;section&gt;</span>
</span><span class='line'>                <span class="c">&lt;!-- Left Nav Section --&gt;</span>
</span><span class='line'>                {$navigation}
</span><span class='line'>                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;right&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;divider&quot;</span><span class="nt">&gt;&lt;/li&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>{Session::get(&#39;current_user&#39;)}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;divider&quot;</span><span class="nt">&gt;&lt;/li&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{URL::to(&#39;logout&#39;)}&quot;</span><span class="nt">&gt;</span>Logout<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>
</span><span class='line'>              <span class="nt">&lt;/section&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/nav&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            @yield(&#39;content&#39;)
</span><span class='line'>            <span class="nt">&lt;hr&gt;</span>
</span><span class='line'>            <span class="nt">&lt;footer&gt;</span>
</span><span class='line'>                <span class="nt">&lt;p&gt;</span><span class="ni">&amp;copy;</span> UMS 2012<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/footer&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- /container --&gt;</span>
</span><span class='line'>        {Asset::scripts()}
</span><span class='line'>        @yield(&#39;script&#39;)
</span><span class='line'>    <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, create another view for the registration of new users.
Again there&rsquo;s nothing bizzare about this.
The only thing that we haven&rsquo;t already used is <code>input::old()</code> and <code>@foreach</code>.  The <code>input::old()</code> method is
used to access the value that was inputted by the user before the form
was submitted. This is very useful since we don&rsquo;t have to write the functionality ourselves, Laravel has already this useful functionality built in to it. The most common use case for this is for forms that has validation errors.
Normally you would want to retrieve the values that were originally submitted.</p>

<p>On the other hand <code>@foreach</code> is just like the <code>foreach</code> that were using in plain PHP: to iterate over an array or an object. In this case were merely iterating through all the departments and the roles for each department in the database. There are only 3 departments so the looping for the department can be done without the <code>@foreach</code> but it is such a joy to use <code>@foreach</code> that I didn&rsquo;t really think of it.</p>

<p>Of course all the data that we are iterating through aren&rsquo;t directly available in the view, we will have to pass the data to the view using the controller which will render this view. And that&rsquo;s what were going to do next.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>@layout(&#39;main&#39;)
</span><span class='line'>
</span><span class='line'>@section(&#39;content&#39;)
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;twelve columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h5&gt;</span>Create User<span class="nt">&lt;/h5&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  @render(&#39;errors&#39;)
</span><span class='line'>  @render(&#39;success&#39;)
</span><span class='line'>  <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;firstname&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>First Name <span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;firstname&quot;</span> <span class="na">id=</span><span class="s">&quot;firstname&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="na">value=</span><span class="s">&quot;{Input::old(&#39;firstname&#39;)}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;middlename&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Middle Name <span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;middlename&quot;</span> <span class="na">id=</span><span class="s">&quot;middlename&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="na">value=</span><span class="s">&quot;{Input::old(&#39;middlename&#39;)}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;lastname&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Last Name<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;lastname&quot;</span> <span class="na">id=</span><span class="s">&quot;lastname&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="na">value=</span><span class="s">&quot;{Input::old(&#39;lastname&#39;)}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">id=</span><span class="s">&quot;username&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="na">value=</span><span class="s">&quot;{Input::old(&#39;username&#39;)}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;password&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;department&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Department<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;department&quot;</span> <span class="na">id=</span><span class="s">&quot;department&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="na">list=</span><span class="s">&quot;departments&quot;</span> <span class="na">value=</span><span class="s">&quot;{Input::old(&#39;department&#39;)}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;datalist</span> <span class="na">id=</span><span class="s">&quot;departments&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          @foreach($departments as $dept)
</span><span class='line'>          <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;{$dept-&gt;department}&quot;</span><span class="nt">&gt;</span>{$dept-&gt;department}<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>          @endforeach
</span><span class='line'>        <span class="nt">&lt;/datalist&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;role&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Role<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;role&quot;</span> <span class="na">id=</span><span class="s">&quot;role&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="na">value=</span><span class="s">&quot;{Input::old(&#39;role&#39;)}&quot;</span> <span class="na">list=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;datalist</span> <span class="na">id=</span><span class="s">&quot;it&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          @foreach($it_roles as $a)
</span><span class='line'>            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;{$a-&gt;role}&quot;</span><span class="nt">&gt;</span>{$a-&gt;role}<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>          @endforeach
</span><span class='line'>        <span class="nt">&lt;/datalist&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;datalist</span> <span class="na">id=</span><span class="s">&quot;defense&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          @foreach($defense_roles as $b)
</span><span class='line'>            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;{$b-&gt;role}&quot;</span><span class="nt">&gt;</span>{$b-&gt;role}<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>          @endforeach
</span><span class='line'>        <span class="nt">&lt;/datalist&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;datalist</span> <span class="na">id=</span><span class="s">&quot;marketing&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          @foreach($marketing_roles as $c)
</span><span class='line'>            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;{$c-&gt;role}&quot;</span><span class="nt">&gt;</span>{$c-&gt;role}<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>          @endforeach
</span><span class='line'>        <span class="nt">&lt;/datalist&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;four columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;eight columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;success medium button&quot;</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Create User<span class="nt">&lt;/button&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/form&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>@endsection
</span></code></pre></td></tr></table></div></figure>


<h3>Admin Controller</h3>

<p>As I have said earlier were now going to create the controller that will
contain the code to render and process the form that we&rsquo;ve just created.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>php artisan generate:controller admin restful
</span></code></pre></td></tr></table></div></figure>


<h4>Default Data</h4>

<p>Define the default data that will be used throughout the controller.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>private $departments;
</span><span class='line'>private $it_roles;
</span><span class='line'>private $marketing_roles;
</span><span class='line'>private $defense_roles;
</span></code></pre></td></tr></table></div></figure>


<h4>Constructor</h4>

<p>On the constructor we first have to call <code>parent::__construct();</code> to make sure we won&rsquo;t be overriding what the base controller has on its constructor.</p>

<p>In the code below were using 1 new animal which is the <code>Cache</code>. The <code>Cache</code> class is basically used
for caching things or saving things temporarily to a location were access is faster.
This is commonly used for caching data from the database so the application won&rsquo;t have to hit the database
everytime a particular page is accessed by a user.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">Cache</span><span class="o">::</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;admin_defaults&#39;</span><span class="p">)){</span> <span class="c1">//check if the cache has already the ```admin_defaults``` item</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$admin_defaults</span>        <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;admin_defaults&#39;</span><span class="p">);</span>  <span class="c1">//get the admin defaults</span>
</span><span class='line'>      <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">departments</span>     <span class="o">=</span> <span class="nv">$admin_defaults</span><span class="p">[</span><span class="s1">&#39;departments&#39;</span><span class="p">];</span>
</span><span class='line'>      <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">it_roles</span>        <span class="o">=</span> <span class="nv">$admin_defaults</span><span class="p">[</span><span class="s1">&#39;it_roles&#39;</span><span class="p">];</span>
</span><span class='line'>      <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marketing_roles</span> <span class="o">=</span> <span class="nv">$admin_defaults</span><span class="p">[</span><span class="s1">&#39;marketing_roles&#39;</span><span class="p">];</span>
</span><span class='line'>      <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">defense_roles</span>   <span class="o">=</span> <span class="nv">$admin_defaults</span><span class="p">[</span><span class="s1">&#39;defense_roles&#39;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span> <span class="c1">//if the cache doesn&#39;t have it yet</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">departments</span>     <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;sys_departments&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span><span class='line'>      <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">it_roles</span>        <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;sys_roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;department_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marketing_roles</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;sys_roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;department_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">defense_roles</span>   <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;sys_roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;department_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//cache the database results so we won&#39;t need to fetch them again for 10 minutes at least</span>
</span><span class='line'>      <span class="nx">Cache</span><span class="o">::</span><span class="na">put</span><span class="p">(</span>
</span><span class='line'>          <span class="s1">&#39;admin_defaults&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="k">array</span><span class="p">(</span>
</span><span class='line'>              <span class="s1">&#39;departments&#39;</span>     <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">departments</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;it_roles&#39;</span>        <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">it_roles</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;marketing_roles&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marketing_roles</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;defense_roles&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">defense_roles</span>
</span><span class='line'>          <span class="p">),</span>
</span><span class='line'>          <span class="mi">10</span>
</span><span class='line'>      <span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;auth&#39;</span><span class="p">);</span> <span class="c1">//run the auth filter before every request of this controller</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h4>Rendering Form for Creating New Users</h4>

<p>Going back to the method which will render the view for creating a new user.
We&rsquo;ll just have to pass in the data that we got earlier from the database.
The data that were passing here is what we have loop through earlier when we created the view for creating a new user.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">get_new_user</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="s1">&#39;admin.create_user&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="k">array</span><span class="p">(</span>
</span><span class='line'>              <span class="s1">&#39;departments&#39;</span>     <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">departments</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;it_roles&#39;</span>        <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">it_roles</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;marketing_roles&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marketing_roles</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;defense_roles&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">defense_roles</span>
</span><span class='line'>          <span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h4>Saving Users into Database</h4>

<p>Now let&rsquo;s write the code for saving the new user into the database.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">post_new_user</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//get user details</span>
</span><span class='line'>  <span class="nv">$firstname</span>  <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;firstname&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$middlename</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;middlename&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$lastname</span>   <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;lastname&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$department</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;department&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$role</span>       <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$username</span>   <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$password</span>   <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//check if the form is valid</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">User</span><span class="o">::</span><span class="na">is_valid</span><span class="p">()){</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="s1">&#39;admin/new_user&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">with_errors</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nv">$validation</span><span class="p">)</span> <span class="c1">//pass in errors</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">with_input</span><span class="p">();</span> <span class="c1">//pass in the data inputted by user </span>
</span><span class='line'>  
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="nv">$password</span> <span class="o">=</span> <span class="nx">Hash</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nv">$password</span><span class="p">);</span> <span class="c1">//hash the password</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//get the department id of the department selected by the user</span>
</span><span class='line'>      <span class="nv">$selected_department</span> <span class="o">=</span> <span class="nx">Department</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;department&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$department</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">first</span><span class="p">(</span><span class="s1">&#39;department_id&#39;</span><span class="p">);</span>
</span><span class='line'>          
</span><span class='line'>
</span><span class='line'>      <span class="nv">$department_id</span> <span class="o">=</span> <span class="nv">$selected_department</span><span class="o">-&gt;</span><span class="na">department_id</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//get the role id of the role selected by user </span>
</span><span class='line'>      <span class="nv">$selected_role</span> <span class="o">=</span> <span class="nx">Role</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$role</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">(</span><span class="s1">&#39;role_id&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$role_id</span> <span class="o">=</span> <span class="nv">$selected_role</span><span class="o">-&gt;</span><span class="na">role_id</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$user_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>                          <span class="s1">&#39;firstname&#39;</span> <span class="o">=&gt;</span> <span class="nv">$firstname</span><span class="p">,</span>
</span><span class='line'>                          <span class="s1">&#39;middlename&#39;</span> <span class="o">=&gt;</span> <span class="nv">$middlename</span><span class="p">,</span>
</span><span class='line'>                          <span class="s1">&#39;lastname&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lastname</span><span class="p">,</span>
</span><span class='line'>                          <span class="s1">&#39;department_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$department_id</span><span class="p">,</span>
</span><span class='line'>                          <span class="s1">&#39;role_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$role_id</span><span class="p">,</span>
</span><span class='line'>                          <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span><span class="p">,</span>
</span><span class='line'>                          <span class="s1">&#39;hashed_password&#39;</span> <span class="o">=&gt;</span> <span class="nv">$password</span>
</span><span class='line'>                          <span class="p">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="nv">$user_data</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$user_id</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">connection</span><span class="p">(</span><span class="s1">&#39;mysql&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">pdo</span><span class="o">-&gt;</span><span class="na">lastInsertId</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$cache_data</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">all</span><span class="p">();</span> <span class="c1">//get all user inputs</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//additional data to be included in the cache</span>
</span><span class='line'>      <span class="nv">$cache_data</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$user_id</span><span class="p">;</span>
</span><span class='line'>      <span class="nv">$cache_data</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">add_cache_item</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nv">$cache_data</span><span class="p">);</span> <span class="c1">//add the new user to the cache</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">log_action</span><span class="p">(</span><span class="s2">&quot;create new user&quot;</span><span class="p">);</span> <span class="c1">//log the action into the database</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//redirect to the create user form with the awesome success message</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="s1">&#39;admin/new_user&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;success_message&#39;</span><span class="p">,</span> <span class="s1">&#39;User Successfully Created&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Hopefully you&rsquo;ve tried to go over the code because now I&rsquo;ll try to explain some of the code
that the comments failed to explain.</p>

<p>Here&rsquo;s a summary of what the above code does:</p>

<ol>
<li><p>Get the user input</p></li>
<li><p>Validate the form. But here I&rsquo;ve included the rules in the models.
I think this is a good practice, for any form that uses the model the same validation rules will be applied.
Which then results to a more DRYer code.</p></li>
<li><p>If the user input is not valid we redirect it to the form with the errors and the old input.</p></li>
<li><p>If the user input is valid then we get the department id and role id from the database based on what department and role is selected by the user.</p></li>
<li><p>Save the user to the database.</p></li>
<li><p>Get all user inputs and store it to <code>$cache_data</code> this will be added to the
cache using the <code>add_cache_item()</code> method which we will add as a helper function later.</p></li>
<li><p>Call <code>log_action()</code> to save the users action into the database</p></li>
</ol>


<h4>Cache Helper</h4>

<p>As I have said earlier I added a helper that will utilize the <code>Cache</code> class to help me add cache items easier.
It&rsquo;s a very simple function which checks if a cache item exists.
If it exists we store it in a variable <code>$current_data</code> . Then we add the new data to the current data using <code>array_push()</code>.
Finally we put back the new one into the cache.
Helper functions are stored in <code>laravel/helpers.php</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">function</span> <span class="nf">add_cache_item</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$data</span><span class="p">){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">Cache</span><span class="o">::</span><span class="na">has</span><span class="p">(</span><span class="nv">$key</span><span class="p">)){</span> <span class="c1">//check if item exists in the cache</span>
</span><span class='line'>      <span class="nv">$current_data</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span> <span class="c1">//store it to a variable</span>
</span><span class='line'>      <span class="nb">array_push</span><span class="p">(</span><span class="nv">$current_data</span><span class="p">,</span> <span class="p">(</span><span class="nx">object</span><span class="p">)</span><span class="nv">$data</span><span class="p">);</span> <span class="c1">//add the data to the variable</span>
</span><span class='line'>      <span class="nx">Cache</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$current_data</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span> <span class="c1">//replace the data which is currently on the cache with the new one</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h4>Log Action</h4>

<p>We&rsquo;ve also used another helper function which is <code>log_action()</code> which is simply used to log what
every user is doing into the database.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">function</span> <span class="nf">log_action</span><span class="p">(</span><span class="nv">$transaction</span><span class="p">){</span>
</span><span class='line'>  <span class="nv">$user_id</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;current_user_id&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$user</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;current_user&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$department</span> <span class="o">=</span> <span class="nx">URI</span><span class="o">::</span><span class="na">segment</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//save the log into the database</span>
</span><span class='line'>  <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;userlogs&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span>
</span><span class='line'>      <span class="k">array</span><span class="p">(</span>
</span><span class='line'>          <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user_id</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;department&#39;</span> <span class="o">=&gt;</span> <span class="nv">$department</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;transaction&#39;</span> <span class="o">=&gt;</span> <span class="nv">$transaction</span>
</span><span class='line'>          <span class="p">)</span>
</span><span class='line'>      <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h3>Roles</h3>

<p>Just like in every application roles are used to group users.
Some examples of roles are: System Administrator, Supervisor, Clerk, Collector and just
about anyone that will interact with the application.
Just like in the real world every user which has the same role will be able to do just about the same
thing. This makes roles a good way to group users based on what they can and cannot do in an application.</p>

<h4>Creating New Roles</h4>

<p>Create a new view called <code>create_role</code> where we will put the form for creating new roles.
This will have two fields: department and role.
The idea here is that for every department there are 1 or more roles that can be added.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>@layout(&#39;main&#39;)
</span><span class='line'>
</span><span class='line'>@section(&#39;content&#39;)
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;twelve columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;h5&gt;</span>Create Role<span class="nt">&lt;/h5&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      @render(&#39;errors&#39;)
</span><span class='line'>      @render(&#39;success&#39;)
</span><span class='line'>      <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;department&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Department<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;department&quot;</span> <span class="na">id=</span><span class="s">&quot;department&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="na">list=</span><span class="s">&quot;departments&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;datalist</span> <span class="na">id=</span><span class="s">&quot;departments&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                @foreach($departments as $dept)
</span><span class='line'>                  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;{$dept-&gt;department}&quot;</span><span class="nt">&gt;</span>{$dept-&gt;department}<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>                @endforeach
</span><span class='line'>                <span class="nt">&lt;/datalist&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;role&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Role <span class="nt">&lt;/label&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;role&quot;</span> <span class="na">id=</span><span class="s">&quot;role&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;four columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      
</span><span class='line'>          <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;eight columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;success medium button&quot;</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Create Role<span class="nt">&lt;/button&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/form&gt;</span>
</span><span class='line'>      
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>@endsection
</span></code></pre></td></tr></table></div></figure>


<p>Then add a new method in the <code>admin</code> controller which will render the view that we have created.
Here were just passing in the departments that are already saved in the database.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">get_new_role</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$departments</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;departments&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="s1">&#39;admin.create_role&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;departments&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">departments</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Just like for every form if there&rsquo;s a <code>get</code> there&rsquo;s also a <code>post</code> as I have said earlier
methods with a prefix of <code>get</code> are used for rendering views while <code>post</code> are used
for processing forms that are submitted.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">post_new_role</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//get the data inputted by the user</span>
</span><span class='line'>  <span class="nv">$department</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;department&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$role</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">Role</span><span class="o">::</span><span class="na">is_valid</span><span class="p">()){</span> <span class="c1">//check if submitted data is valid</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="s1">&#39;admin/new_role&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">with_errors</span><span class="p">(</span><span class="nx">Role</span><span class="o">::</span><span class="nv">$validation</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">with_input</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="nv">$selected_department</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;sys_departments&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;department&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$department</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">first</span><span class="p">(</span><span class="s1">&#39;department_id&#39;</span><span class="p">);</span>
</span><span class='line'>          
</span><span class='line'>      <span class="nv">$department_id</span> <span class="o">=</span> <span class="nv">$selected_department</span><span class="o">-&gt;</span><span class="na">department_id</span><span class="p">;</span>
</span><span class='line'>      
</span><span class='line'>      <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;sys_roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span>
</span><span class='line'>          <span class="k">array</span><span class="p">(</span>
</span><span class='line'>              <span class="s1">&#39;department_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$department_id</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="nv">$role</span>
</span><span class='line'>          <span class="p">));</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$role_id</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">connection</span><span class="p">(</span><span class="s1">&#39;mysql&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">pdo</span><span class="o">-&gt;</span><span class="na">lastInsertId</span><span class="p">();</span> <span class="c1">//get the last inserted primary key</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//select all the transactions (things that can be done for the selected department)</span>
</span><span class='line'>      <span class="nv">$transactions</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;sys_transactions&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;department_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$department_id</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">//loop through the results </span>
</span><span class='line'>      <span class="k">foreach</span><span class="p">(</span><span class="nv">$transactions</span> <span class="k">as</span> <span class="nv">$t</span><span class="p">){</span>
</span><span class='line'>          <span class="nv">$transaction_id</span> <span class="o">=</span> <span class="nv">$t</span><span class="o">-&gt;</span><span class="na">transaction_id</span><span class="p">;</span> <span class="c1">//get the transaction id</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">//save to the rolestransactions table</span>
</span><span class='line'>          <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;roletransactions&#39;</span><span class="p">)</span>
</span><span class='line'>              <span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;role_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$role_id</span><span class="p">,</span> <span class="s1">&#39;transaction_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$transaction_id</span><span class="p">));</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">Cache</span><span class="o">::</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;admin_defaults&#39;</span><span class="p">)){</span> <span class="c1">//check if a cache item for admin_defaults already exists </span>
</span><span class='line'>          <span class="nv">$admin_defaults</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;admin_defaults&#39;</span><span class="p">);</span>
</span><span class='line'>          
</span><span class='line'>          <span class="c1">//add the new role into the cache</span>
</span><span class='line'>          <span class="nb">array_push</span><span class="p">(</span><span class="nv">$admin_defaults</span><span class="p">[</span><span class="nv">$department</span> <span class="o">.</span> <span class="s1">&#39;_roles&#39;</span><span class="p">],</span> <span class="p">(</span><span class="nx">object</span><span class="p">)</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="nv">$role</span><span class="p">));</span>
</span><span class='line'>          <span class="nx">Cache</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;admin_defaults&#39;</span><span class="p">,</span> <span class="nv">$admin_defaults</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">log_action</span><span class="p">(</span><span class="s2">&quot;create new role&quot;</span><span class="p">);</span> <span class="c1">//save the action to the database</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">//redirect to the create role form with the success message </span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="s1">&#39;admin/new_role&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;success_message&#39;</span><span class="p">,</span> <span class="s1">&#39;Role Successfully Created&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h3>Select Users</h3>

<p>We&rsquo;ll also need to have a feature wherein the administrator can view a list of the users who are using the application.
This will also serve as a link to the user update page where the administrator can
update user details. The administrator can also update the status of the user from this page.
The status can either be <code>enabled</code> or <code>disabled</code> if the user is disabled then he cannot login to the application. Lastly, we&rsquo;ll also include a link to the user activity log so that the administrator can view
all the transactions that the user has performed in the application.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>@layout(&#39;main&#39;)
</span><span class='line'>
</span><span class='line'>@section(&#39;content&#39;)
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;twelve columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h5&gt;</span>Users<span class="nt">&lt;/h5&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">&quot;twelve dtable&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;thead&gt;</span>
</span><span class='line'>      <span class="nt">&lt;tr&gt;</span>
</span><span class='line'>        <span class="nt">&lt;th&gt;</span>Username<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>        <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>        <span class="nt">&lt;th&gt;</span>Department<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>        <span class="nt">&lt;th&gt;</span>Role<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>        <span class="nt">&lt;th&gt;</span>Logs<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>        <span class="nt">&lt;th&gt;</span>Status<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>        <span class="nt">&lt;th&gt;</span>Update<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/tr&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/thead&gt;</span>
</span><span class='line'>    <span class="nt">&lt;tbody&gt;</span>
</span><span class='line'>      @foreach($users as $user)
</span><span class='line'>      <span class="cp">&lt;?php</span>
</span><span class='line'><span class="cp">     $icons = [&quot;foundicon-lock&quot;, &quot;foundicon-unlock&quot;];</span>
</span><span class='line'><span class="cp">     $actions = [1, 0];</span>
</span><span class='line'><span class="cp">     ?&gt;</span>
</span><span class='line'>      <span class="nt">&lt;tr&gt;</span>
</span><span class='line'>          <span class="nt">&lt;td&gt;</span>{$user-&gt;username}<span class="nt">&lt;/td&gt;</span>
</span><span class='line'>          <span class="nt">&lt;td&gt;</span>{$user-&gt;firstname . &quot; &quot; . $user-&gt;lastname}<span class="nt">&lt;/td&gt;</span>
</span><span class='line'>          <span class="nt">&lt;td&gt;</span>{$user-&gt;department}<span class="nt">&lt;/td&gt;</span>
</span><span class='line'>          <span class="nt">&lt;td&gt;</span>{$user-&gt;role}<span class="nt">&lt;/td&gt;</span>
</span><span class='line'>          <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;pointer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;icons foundicon-address-book&quot;</span> <span class="na">data-url=</span><span class="s">&quot;{URL::to(&#39;admin/logs/&#39; . $user-&gt;user_id)}&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/td&gt;</span>
</span><span class='line'>          <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;pointer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;icons {$icons[$user-&gt;status]}&quot;</span> <span class="na">data-action=</span><span class="s">&quot;{$actions[$user-&gt;status]}&quot;</span> <span class="na">data-uid=</span><span class="s">&quot;{$user-&gt;user_id}&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/td&gt;</span>
</span><span class='line'>          <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;pointer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;icons foundicon-refresh&quot;</span> <span class="na">data-url=</span><span class="s">&quot;{URL::to(&#39;admin/user/&#39; . $user-&gt;user_id)}&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/td&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/tr&gt;</span>
</span><span class='line'>      @endforeach
</span><span class='line'>    <span class="nt">&lt;/tbody&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/table&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>@endsection
</span><span class='line'>
</span><span class='line'>@section(&#39;script&#39;)
</span><span class='line'><span class="nt">&lt;script&gt;</span>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;td.pointer&quot;</span><span class="p">).</span><span class="nx">live</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//get the data-url value from the &lt;i&gt; tag</span>
</span><span class='line'>  <span class="c1">//it feels weird to put data attributes to a table definition so </span>
</span><span class='line'>  <span class="c1">//we have to do some selector-fu to get to the data that we want</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">children</span><span class="p">().</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">url</span><span class="p">){</span> <span class="c1">//just making sure that url is storing a truthy value</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//cheap trick for changing page location</span>
</span><span class='line'>      <span class="c1">//I wouldn&#39;t actually do it this way</span>
</span><span class='line'>      <span class="c1">//if the anchor tag &lt;a&gt; works when its wrapping an &lt;i&gt; tag</span>
</span><span class='line'>      <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;td.pointer&quot;</span><span class="p">).</span><span class="nx">hover</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//on hover: make the user see that he&#39;s actually hovering on something by changing the color</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">children</span><span class="p">().</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;#0CAEE3&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">},</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//on mouse out: change back to the original color</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">children</span><span class="p">().</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;#333&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;td.pointer&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">;</span> <span class="c1">//get all the information of the current page (Eg. host, hostname, port, etc.)</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//caching the information about the child of the clicked element so we won&#39;t have to select it again later </span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">child</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">children</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">user_id</span> <span class="o">=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;uid&quot;</span><span class="p">);</span> <span class="c1">//accessing the value of data-uid attribute using the cache item(child) as the base</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">status</span> <span class="o">=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">);</span> <span class="c1">//accessing the value of data-uid attribute using the cache item(child) as the base</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//update user status using ajax</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span>
</span><span class='line'>      <span class="nx">url</span><span class="p">.</span><span class="nx">origin</span> <span class="o">+</span> <span class="s2">&quot;/admin/update_userstatus/&quot;</span> <span class="o">+</span> <span class="nx">user_id</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">status</span><span class="p">,</span>
</span><span class='line'>      <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span> <span class="c1">//the response is either 1 or 0, if the admin disabled the user the response would be the opposite which is 1. If the admin enabled the user the response would be 0</span>
</span><span class='line'>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">icons</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;foundicon-unlock&quot;</span><span class="p">,</span> <span class="s2">&quot;foundicon-lock&quot;</span><span class="p">];</span>
</span><span class='line'>          <span class="nx">child</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">();</span>
</span><span class='line'>          <span class="nx">child</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;icons &quot;</span> <span class="o">+</span> <span class="nx">icons</span><span class="p">[</span><span class="nx">response</span><span class="p">]);</span> <span class="c1">//change the icon based on the response</span>
</span><span class='line'>          <span class="nx">child</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span> <span class="c1">//change the data-action attribute based on response</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>@endsection
</span></code></pre></td></tr></table></div></figure>


<p>Back to the <code>admin</code> controller. Create a new method and call it <code>post_update_userstatus</code> it will
accept two arguments: user_id and status.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">post_update_userstatus</span><span class="p">(</span><span class="nv">$user_id</span><span class="p">,</span> <span class="nv">$status</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//update user status</span>
</span><span class='line'>  <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;tbl_users&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$user_id</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="nv">$status</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">log_action</span><span class="p">(</span><span class="s2">&quot;update user status&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//determine the new status </span>
</span><span class='line'>  <span class="nv">$new_status</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>      <span class="c1">//the new status will be equal to 0 if status is 1, it will be equal to 1 if status is 0</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$new_status</span><span class="p">;</span> <span class="c1">//echo it out, this is the response that were getting earlier from JavaScript</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>To render the view for viewing the list of users, create another method.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">get_users</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">Cache</span><span class="o">::</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)){</span> <span class="c1">//if the users has not already been cached</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//get the users from the database</span>
</span><span class='line'>      <span class="nv">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">join</span><span class="p">(</span><span class="s1">&#39;sys_departments&#39;</span><span class="p">,</span> <span class="s1">&#39;tbl_users.department_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;sys_departments.department_id&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">join</span><span class="p">(</span><span class="s1">&#39;sys_roles&#39;</span><span class="p">,</span> <span class="s1">&#39;tbl_users.role_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;sys_roles.role_id&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;firstname&#39;</span><span class="p">,</span> <span class="s1">&#39;lastname&#39;</span><span class="p">,</span> <span class="s1">&#39;department&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$users_data</span> <span class="o">=</span> <span class="nv">$users</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">Cache</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nv">$users_data</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>  <span class="c1">//put the users into the cache for 10 minutes</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span> <span class="c1">//if the users are already in the cache</span>
</span><span class='line'>      <span class="nv">$users_data</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span> <span class="c1">//just get the users from the cache</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//render the view for viewing the list of users</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="s1">&#39;admin.users&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nv">$users_data</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h3>Updating a User</h3>

<p>Create another view for updating the user.
This is very similar to the view for creating users.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>@layout(&#39;main&#39;)
</span><span class='line'>
</span><span class='line'>@section(&#39;content&#39;)
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;twelve columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h5&gt;</span>Update User<span class="nt">&lt;/h5&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  @render(&#39;errors&#39;)
</span><span class='line'>  @render(&#39;success&#39;)
</span><span class='line'>  <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;firstname&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>First Name <span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;firstname&quot;</span> <span class="na">id=</span><span class="s">&quot;firstname&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="na">value=</span><span class="s">&quot;{$user-&gt;firstname}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;middlename&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Middle Name <span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;middlename&quot;</span> <span class="na">id=</span><span class="s">&quot;middlename&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="na">value=</span><span class="s">&quot;{$user-&gt;middlename}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;lastname&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Last Name<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;lastname&quot;</span> <span class="na">id=</span><span class="s">&quot;lastname&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="na">value=</span><span class="s">&quot;{$user-&gt;lastname}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">id=</span><span class="s">&quot;username&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="na">value=</span><span class="s">&quot;{$user-&gt;username}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;password&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;department&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Department<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;department&quot;</span> <span class="na">id=</span><span class="s">&quot;department&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="na">value=</span><span class="s">&quot;{$user-&gt;department}&quot;</span> <span class="na">list=</span><span class="s">&quot;departments&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;datalist</span> <span class="na">id=</span><span class="s">&quot;departments&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          @foreach($departments as $dept)
</span><span class='line'>          <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;{$dept-&gt;department}&quot;</span><span class="nt">&gt;</span>{$dept-&gt;department}<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>          @endforeach
</span><span class='line'>        <span class="nt">&lt;/datalist&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;role&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Role<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ten columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;role&quot;</span> <span class="na">id=</span><span class="s">&quot;role&quot;</span> <span class="na">class=</span><span class="s">&quot;five&quot;</span> <span class="na">value=</span><span class="s">&quot;{$user-&gt;role}&quot;</span> <span class="na">list=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;datalist</span> <span class="na">id=</span><span class="s">&quot;it&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          @foreach($it_roles as $a)
</span><span class='line'>            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;{$a-&gt;role}&quot;</span><span class="nt">&gt;</span>{$a-&gt;role}<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>          @endforeach
</span><span class='line'>        <span class="nt">&lt;/datalist&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;datalist</span> <span class="na">id=</span><span class="s">&quot;defense&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          @foreach($defense_roles as $b)
</span><span class='line'>            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;{$b-&gt;role}&quot;</span><span class="nt">&gt;</span>{$b-&gt;role}<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>          @endforeach
</span><span class='line'>        <span class="nt">&lt;/datalist&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;datalist</span> <span class="na">id=</span><span class="s">&quot;marketing&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          @foreach($marketing_roles as $c)
</span><span class='line'>            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;{$c-&gt;role}&quot;</span><span class="nt">&gt;</span>{$c-&gt;role}<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>          @endforeach
</span><span class='line'>        <span class="nt">&lt;/datalist&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;four columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;eight columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;success medium button&quot;</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Update User<span class="nt">&lt;/button&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/form&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>@endsection
</span></code></pre></td></tr></table></div></figure>


<p>Create another method in the <code>admin</code> controller that will render the user update form.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">get_user</span><span class="p">(</span><span class="nv">$user_id</span><span class="p">){</span>
</span><span class='line'>  <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_get_userdata</span><span class="p">(</span><span class="nv">$user_id</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="na">make</span><span class="p">(</span>
</span><span class='line'>      <span class="s1">&#39;admin.user&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="k">array</span><span class="p">(</span>
</span><span class='line'>          <span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;departments&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">departments</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;it_roles&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">it_roles</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;marketing_roles&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marketing_roles</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;defense_roles&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">defense_roles</span>
</span><span class='line'>          <span class="p">)</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>You will notice that we have used a method called <code>_get_userdata()</code> which takes the users id as
an argument. This method returns the user details based on the id that is specified.
We are joining the <code>departments</code> and <code>roles</code> table as well to get the department and the role to which the user belongs. Then we use the <code>where()</code> method to specify that we only want to get the user
which has a specific id. Then we use the <code>first()</code> method to let Laravel know that we only want to fetch a single record. Because when we just use <code>get()</code> Laravel(fluent) will return an array and we&rsquo;ll have to access
the results later on by doing something like <code>$user_data[0]-&gt;user_id</code> which isn&rsquo;t that bad but we&rsquo;ll have two type more characters.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">private</span> <span class="k">function</span> <span class="nf">_get_userdata</span><span class="p">(</span><span class="nv">$user_id</span><span class="p">){</span>
</span><span class='line'>  <span class="nv">$user_data</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">join</span><span class="p">(</span><span class="s1">&#39;departments&#39;</span><span class="p">,</span> <span class="s1">&#39;users.department_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;departments.id&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">join</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">,</span> <span class="s1">&#39;users.role_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;roles.id&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$user_id</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">first</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;firstname&#39;</span><span class="p">,</span> <span class="s1">&#39;middlename&#39;</span><span class="p">,</span> <span class="s1">&#39;lastname&#39;</span><span class="p">,</span> <span class="s1">&#39;department&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">));</span>
</span><span class='line'>  <span class="k">return</span> <span class="nv">$user_data</span><span class="p">;</span>    
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Then the code for updating the user details.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">post_user</span><span class="p">(</span><span class="nv">$user_id</span><span class="p">){</span>
</span><span class='line'>  <span class="nv">$firstname</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;firstname&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$middlename</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;middlename&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$lastname</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;lastname&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$department</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;department&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$role</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$username</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$password</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//bend the rules for updating user data</span>
</span><span class='line'>  <span class="nx">User</span><span class="o">::</span><span class="nv">$rules</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;required|unique:tbl_users,username,&#39;</span> <span class="o">.</span><span class="nv">$user_id</span> <span class="o">.</span> <span class="s1">&#39;,user_id&#39;</span><span class="p">;</span> <span class="c1">//username is still unique but we need to exclude the user that were currently updating by specifying the user id</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">User</span><span class="o">::</span><span class="nv">$rules</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span> <span class="c1">//by default password is required now it isn&#39;t</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">User</span><span class="o">::</span><span class="na">is_valid</span><span class="p">()){</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="s1">&#39;admin/user/&#39;</span> <span class="o">.</span> <span class="nv">$user_id</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">with_errors</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nv">$validation</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">with_input</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="nv">$selected_department</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;sys_departments&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;department&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$department</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">first</span><span class="p">(</span><span class="s1">&#39;department_id&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$department_id</span> <span class="o">=</span> <span class="nv">$selected_department</span><span class="o">-&gt;</span><span class="na">department_id</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$selected_role</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;sys_roles&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$role</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">(</span><span class="s1">&#39;role_id&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$role_id</span> <span class="o">=</span> <span class="nv">$selected_role</span><span class="o">-&gt;</span><span class="na">role_id</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span> <span class="c1">//data if password is updated</span>
</span><span class='line'>          <span class="nv">$password</span> <span class="o">=</span> <span class="nx">Hash</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nv">$password</span><span class="p">);</span>
</span><span class='line'>          <span class="nv">$user_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>              <span class="s1">&#39;firstname&#39;</span> <span class="o">=&gt;</span> <span class="nv">$firstname</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;middlename&#39;</span> <span class="o">=&gt;</span> <span class="nv">$middlename</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;lastname&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lastname</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;department_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$department_id</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;role_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$role_id</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;hashed_password&#39;</span> <span class="o">=&gt;</span> <span class="nv">$password</span>
</span><span class='line'>          <span class="p">);</span>
</span><span class='line'>      <span class="p">}</span><span class="k">else</span><span class="p">{</span> <span class="c1">//data if password is not update</span>
</span><span class='line'>          <span class="nv">$user_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>              <span class="s1">&#39;firstname&#39;</span> <span class="o">=&gt;</span> <span class="nv">$firstname</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;middlename&#39;</span> <span class="o">=&gt;</span> <span class="nv">$middlename</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;lastname&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lastname</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;department_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$department_id</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;role_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$role_id</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span>
</span><span class='line'>          <span class="p">);</span>   
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//update user details</span>
</span><span class='line'>      <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;tbl_users&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$user_id</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nv">$user_data</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">log_action</span><span class="p">(</span><span class="s2">&quot;update user&quot;</span><span class="p">);</span>  
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="s1">&#39;admin/user/&#39;</span> <span class="o">.</span> <span class="nv">$user_id</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;success_message&#39;</span><span class="p">,</span> <span class="s1">&#39;User Successfully Updated&#39;</span><span class="p">);</span>  
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h3>User Logs</h3>

<p>Create another view and call it <code>userlogs</code>. Nothing fancy here, this will just list out all the activities/transactions performed by a specific user or all users on the current day.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>@layout(&#39;main&#39;)
</span><span class='line'>
</span><span class='line'>@section(&#39;content&#39;)
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;twelve columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h5&gt;</span>User Logs - {$scope}<span class="nt">&lt;/h5&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;twelve columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">&quot;twelve dtable&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;thead&gt;</span>
</span><span class='line'>          <span class="nt">&lt;tr&gt;</span>
</span><span class='line'>            <span class="nt">&lt;th&gt;</span>Username<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>            <span class="nt">&lt;th&gt;</span>Department<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>            <span class="nt">&lt;th&gt;</span>Activity<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>            <span class="nt">&lt;th&gt;</span>Timestamp<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/tr&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/thead&gt;</span>
</span><span class='line'>        <span class="nt">&lt;tbody&gt;</span>
</span><span class='line'>          @foreach($userlogs as $logs)
</span><span class='line'>          <span class="nt">&lt;tr&gt;</span>
</span><span class='line'>              <span class="nt">&lt;td&gt;</span>{$logs-&gt;user}<span class="nt">&lt;/td&gt;</span>
</span><span class='line'>              <span class="nt">&lt;td&gt;</span>{$logs-&gt;department}<span class="nt">&lt;/td&gt;</span>
</span><span class='line'>              <span class="nt">&lt;td&gt;</span>{$logs-&gt;transaction}<span class="nt">&lt;/td&gt;</span>
</span><span class='line'>              <span class="nt">&lt;td&gt;</span>{date(&quot;M d, Y @ g:i A&quot;, strtotime($logs-&gt;dateandtime))}<span class="nt">&lt;/td&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/tr&gt;</span>
</span><span class='line'>          @endforeach
</span><span class='line'>        <span class="nt">&lt;/tbody&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/table&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>@endsection
</span></code></pre></td></tr></table></div></figure>


<p>Going back to the <code>admin</code> controller we create another method for rendering the user logs.
Nothing fancy here except for the usage of a raw query which can be done by using the <code>query()</code> method
from the <code>DB</code> class.
If there&rsquo;s a user id supplied then its only going to select the logs for a specific user which has that id.
If there&rsquo;s no user id then its going to select all the transactions performed by every user on that day.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">get_logs</span><span class="p">(</span><span class="nv">$user_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">){</span>
</span><span class='line'>  <span class="nv">$scope</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$user_id</span><span class="p">)){</span>
</span><span class='line'>      <span class="nv">$userlogs</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">query</span><span class="p">(</span><span class="s2">&quot;</span>
</span><span class='line'><span class="s2">         SELECT * FROM tbl_userlog </span>
</span><span class='line'><span class="s2">         WHERE user_id = &#39;</span><span class="si">$user_id</span><span class="s2">&#39;</span>
</span><span class='line'><span class="s2">         ORDER BY dateandtime DESC</span>
</span><span class='line'><span class="s2">     &quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$userlogs</span><span class="p">)){</span>
</span><span class='line'>          <span class="nv">$scope</span> <span class="o">=</span> <span class="nv">$userlogs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="nv">$userlogs</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">         SELECT * FROM tbl_userlog </span>
</span><span class='line'><span class="s1">         WHERE DATE(dateandtime) = CURRENT_DATE</span>
</span><span class='line'><span class="s1">         ORDER BY dateandtime DESC</span>
</span><span class='line'><span class="s1">     &#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$scope</span> <span class="o">=</span> <span class="s1">&#39;All Users&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="s1">&#39;admin.userlogs&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;userlogs&#39;</span> <span class="o">=&gt;</span> <span class="nv">$userlogs</span><span class="p">,</span> <span class="s1">&#39;scope&#39;</span> <span class="o">=&gt;</span> <span class="nv">$scope</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h3>Updating Transaction Status</h3>

<p>Create another view and call it <code>transactions</code> this will be used to update the transactions
that can be performed by each role.</p>

<p>I guess its about time to give a little bit of explanation on what these transactions really are in this project that were creating.</p>

<p>Transactions are the things that the users can do in the application. In this project the navigation is representing the transactions. So disabling a transaction will hide the equivalent menu in the navigation so that the user won&rsquo;t be able to access it. But what we need to do is more than just hiding the menu item. What if the user has already memorized the actual route to access that specific page and he just types it in the address bar?
He will still be able to access the page only this time he didn&rsquo;t have to use the menu.</p>

<p>That&rsquo;s what were going to do later. For now let&rsquo;s put our minds back to the updating of transactions that can be performed by users.</p>

<p>Again there&rsquo;s nothing special about the form below.
The admin will just have to select the role that he wants to update.
After that he&rsquo;ll just click on the <code>view</code> button to load the transactions for that role.
Then he&rsquo;ll just have to deselect the transactions that cannot be performed by the role and select all the transactions that can be performed by the role. Were using <code>ajax</code> to submit the status of the transaction to the server-side that&rsquo;s why we don&rsquo;t have something like a submit button to commit the changes.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>@layout(&#39;main&#39;)
</span><span class='line'>
</span><span class='line'>@section(&#39;content&#39;)
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;twelve columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h5&gt;</span>Roles and Transactions<span class="nt">&lt;/h5&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;role&quot;</span> <span class="na">class=</span><span class="s">&quot;right inline&quot;</span><span class="nt">&gt;</span>Role<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;nine columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">&quot;&quot;</span> <span class="na">id=</span><span class="s">&quot;role&quot;</span> <span class="na">class=</span><span class="s">&quot;seven&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      @foreach($roles as $r)
</span><span class='line'>          <span class="nt">&lt;option</span>
</span><span class='line'>              <span class="na">data-deptid=</span><span class="s">&quot;{$r-&gt;department_id}&quot;</span>
</span><span class='line'>              <span class="na">data-roleid=</span><span class="s">&quot;{$r-&gt;role_id}&quot;</span>
</span><span class='line'>              <span class="na">value=</span><span class="s">&quot;{$r-&gt;role}&quot;</span>
</span><span class='line'>              <span class="err">@</span><span class="na">if</span><span class="err">($</span><span class="na">role_id =</span><span class="s">=</span> <span class="err">$</span><span class="na">r-</span><span class="nt">&gt;</span>role_id)
</span><span class='line'>              {&quot;selected&quot;}
</span><span class='line'>              @endif
</span><span class='line'>          &gt;
</span><span class='line'>              {$r-&gt;role}
</span><span class='line'>          <span class="nt">&lt;/option&gt;</span>
</span><span class='line'>      @endforeach
</span><span class='line'>      <span class="nt">&lt;/select&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span> <span class="na">id=</span><span class="s">&quot;view_transactions&quot;</span> <span class="na">class=</span><span class="s">&quot;success medium button two&quot;</span><span class="nt">&gt;</span>View<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;transactions&quot;</span> <span class="na">class=</span><span class="s">&quot;row transactions&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;twelve columns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>      @foreach($transactions as $t)
</span><span class='line'>          <span class="nt">&lt;li&gt;</span>
</span><span class='line'>              <span class="cp">&lt;?php </span>
</span><span class='line'><span class="cp">             $status = &quot;&quot;;</span>
</span><span class='line'><span class="cp">             if($t-&gt;status == 1){</span>
</span><span class='line'><span class="cp">                 $status = &quot;checked&quot;;</span>
</span><span class='line'><span class="cp">             }</span>
</span><span class='line'><span class="cp">             ?&gt;</span>
</span><span class='line'>              <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">data-id=</span><span class="s">&quot;{$t-&gt;roletransaction_id}&quot;</span> <span class="err">{$</span><span class="na">status</span><span class="err">}</span><span class="nt">&gt;</span>
</span><span class='line'>              {$t-&gt;menu_text}
</span><span class='line'>          <span class="nt">&lt;/li&gt;</span>         
</span><span class='line'>      @endforeach 
</span><span class='line'>      <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>@endsection
</span><span class='line'>
</span><span class='line'>@section(&#39;script&#39;)
</span><span class='line'><span class="nt">&lt;script&gt;</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#role&quot;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">//if the role is changed</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">selected_role</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#role&quot;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;:selected&quot;</span><span class="p">);</span> <span class="c1">//its a good practice to cache a selector if you&#39;re going to use it more than once</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">department_id</span> <span class="o">=</span> <span class="nx">selected_role</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;deptid&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">role_id</span> <span class="o">=</span> <span class="nx">selected_role</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;roleid&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//change the url of the view button(well not actually a button, its a link) based on the role id</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#view_transactions&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">,</span> <span class="nx">url</span><span class="p">.</span><span class="nx">origin</span> <span class="o">+</span> <span class="s2">&quot;/admin/roles/&quot;</span> <span class="o">+</span> <span class="nx">role_id</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input[data-id]&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">roletransaction_id</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">status</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;checked&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//if the box is check the status is 1 if not then its 0</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">;</span> <span class="c1">//get all the information about the current url</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//update transaction status via ajax</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span>
</span><span class='line'>          <span class="nx">url</span><span class="p">.</span><span class="nx">origin</span> <span class="o">+</span> <span class="s2">&quot;/admin/update_transactionstatus/&quot;</span> <span class="o">+</span> <span class="nx">roletransaction_id</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">status</span><span class="p">,</span>
</span><span class='line'>          <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>@endsection
</span></code></pre></td></tr></table></div></figure>


<p>Then render the transactions view.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">get_roles</span><span class="p">(</span><span class="nv">$role_id</span><span class="p">){</span>
</span><span class='line'>  <span class="nv">$roles</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$transactions</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;transactions&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">join</span><span class="p">(</span>
</span><span class='line'>          <span class="s1">&#39;roletransactions&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;transactions.transaction_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;roletransactions.transaction_id&#39;</span>
</span><span class='line'>          <span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$role_id</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>          <span class="s1">&#39;roletransaction_id&#39;</span><span class="p">,</span> <span class="s1">&#39;role_id&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;department_id&#39;</span><span class="p">,</span> <span class="s1">&#39;menu_text&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span>
</span><span class='line'>          <span class="p">)</span>
</span><span class='line'>      <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="na">make</span><span class="p">(</span>
</span><span class='line'>      <span class="s1">&#39;admin.transactions&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="k">array</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="nv">$roles</span><span class="p">,</span> <span class="s1">&#39;transactions&#39;</span> <span class="o">=&gt;</span> <span class="nv">$transactions</span><span class="p">,</span> <span class="s1">&#39;role_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$role_id</span><span class="p">)</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Create another method called <code>post_update_transactionstatus</code>. This is the method that
we have specified earlier in the <code>transactions</code> view
where the <code>roletransaction_id</code> and <code>status</code> is submitted.
As you can see were just accessing those submitted values through the parameters which represents the third and fourth segment of the route.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">post_update_transactionstatus</span><span class="p">(</span><span class="nv">$roletransaction_id</span><span class="p">,</span> <span class="nv">$status</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;roletransactions&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$roletransaction_id</span><span class="p">)</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="nv">$status</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">log_action</span><span class="p">(</span><span class="s2">&quot;update transaction status&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h3>Generating the User Navigation</h3>

<p>Yep! you heard that right, were generating the navigation everytime the user logs in.
Were going to fetch what transactions the user can perform in the application and loop through the results.</p>

<p>This means that for every user, different menu items will be generated.
But of course were not going to have a feature wherein the admin updates the transactions for a particular role and it will automatically update the UI of all the users who are currently logged in to the application.
That would be uber-cool but I don&rsquo;t currently know how to do those real-time applications.</p>

<p>So we&rsquo;ll just stick with old-school for now.
The menu will just change once the user has logged out and logged back in again.
And this is just fine its not like the admin is going to update the transactions that the users can perform every second of the day. We don&rsquo;t need to over-engineer things for the sake of being cool.</p>

<h4>View Composers</h4>

<p>Before anything else I&rsquo;d like to introduce another templating concept in Laravel which is the view composers.
View composers are simply used to nest or attach data or a view into another view.</p>

<p>This is perfect for our purpose since we want the user navigation to be different for each role.</p>

<p>View composers takes 2 parameters.
The first parameter is the view in which you want to attach a specific data.
But of course you can use an array to specify multiple views.</p>

<p>The second parameter is what you want to do to those views.
Here were just attaching data that is fetched from the database.</p>

<p>Go ahead and open up <code>routes.php</code> inside the <code>application</code> directory and add the following code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nx">View</span><span class="o">::</span><span class="na">composer</span><span class="p">(</span>
</span><span class='line'><span class="c1">//specify the views where the data will be attached</span>
</span><span class='line'>  <span class="k">array</span><span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;admin.home&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;admin.create_role&#39;</span><span class="p">,</span> <span class="s1">&#39;admin.create_user&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;admin.user&#39;</span><span class="p">,</span> <span class="s1">&#39;admin.users&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;admin.userlogs&#39;</span><span class="p">,</span> <span class="s1">&#39;admin.transactions&#39;</span>
</span><span class='line'>  <span class="p">),</span>
</span><span class='line'>  <span class="k">function</span><span class="p">(</span><span class="nv">$view</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$role_id</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;role_id&#39;</span><span class="p">);</span> <span class="c1">//load role id of current user from session</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nx">Session</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;navigation&#39;</span><span class="p">)){</span>
</span><span class='line'>      <span class="nv">$nav</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;navigation&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="nv">$transactions</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;roletransactions&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">join</span><span class="p">(</span>
</span><span class='line'>          <span class="s1">&#39;transactions&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;roletransactions.transaction_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;transactions.id&#39;</span>
</span><span class='line'>          <span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;role_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$role_id</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">order_by</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="s1">&#39;ASC&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="s1">&#39;menu_text&#39;</span><span class="p">,</span> <span class="s1">&#39;main_menu&#39;</span><span class="p">,</span> <span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span>
</span><span class='line'>          <span class="p">)</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$nav</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>      <span class="k">foreach</span><span class="p">(</span><span class="nv">$transactions</span> <span class="k">as</span> <span class="nv">$t</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$nav</span><span class="p">[</span><span class="nv">$t</span><span class="o">-&gt;</span><span class="na">main_menu</span><span class="p">][</span><span class="nv">$t</span><span class="o">-&gt;</span><span class="na">menu_text</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$t</span><span class="o">-&gt;</span><span class="na">address</span><span class="p">;</span> <span class="c1">//fill in the array with the results from the database</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//save it into the session to make it accessible later </span>
</span><span class='line'>      <span class="c1">//on pages which needs this information</span>
</span><span class='line'>      <span class="nx">Session</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;navigation&#39;</span><span class="p">,</span> <span class="nv">$nav</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//attach the data that was fetched from the database into the navigation view</span>
</span><span class='line'>    <span class="c1">//first parameter is the name that you want to give the view</span>
</span><span class='line'>    <span class="c1">//second parameter is the actual name of the view. In this case the name is navigation.blade.php</span>
</span><span class='line'>    <span class="c1">//third is the data that you wish to pass in to the navigation view</span>
</span><span class='line'>      <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">nest</span><span class="p">(</span><span class="s1">&#39;navigation&#39;</span><span class="p">,</span> <span class="s1">&#39;navigation&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;navigation&#39;</span> <span class="o">=&gt;</span> <span class="nv">$nav</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h4>Navigation View</h4>

<p>Create a new view just inside the root of the <code>view</code> directory and name it <code>navigation</code> this will serve as the template for the navigation.</p>

<p>If you can still remember from the main template that we created earlier.
We have a variable called <code>navigation</code> and that variable is storing the template below.</p>

<p>It might not click right away but that&rsquo;s how view nesting works.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;left&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;divider&quot;</span><span class="nt">&gt;&lt;/li&gt;</span>
</span><span class='line'>    @foreach($navigation as $key =&gt; $nav)
</span><span class='line'>      <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;has-dropdown&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">class=</span><span class="s">&quot;active&quot;</span><span class="nt">&gt;</span>{$key}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;dropdown&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          @foreach($nav as $subnav =&gt; $link)
</span><span class='line'>          <span class="nt">&lt;li&gt;</span>
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{URL::to($link)}&quot;</span><span class="nt">&gt;</span>{$subnav}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>          @endforeach
</span><span class='line'>        <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    @endforeach
</span><span class='line'><span class="nt">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Check User Access</h4>

<p>Going back to the <code>routes.php</code> file. Create a filter and call it <code>check_roles</code> we will use this filter to check if the current user has the authority/privilege to access the page that he is trying to access.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nx">Route</span><span class="o">::</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;check_roles&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$current_url</span> <span class="o">=</span> <span class="nx">URI</span><span class="o">::</span><span class="na">current</span><span class="p">();</span>   <span class="c1">//get current url excluding the domain.</span>
</span><span class='line'>    <span class="nv">$current_page</span> <span class="o">=</span> <span class="nx">URI</span><span class="o">::</span><span class="na">segment</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">//get current page which is stored in the second uri segment. Just a refresher: //the first uri segment is the controller, the second is the method, </span>
</span><span class='line'>      <span class="c1">//third and up are the parameters that you wish to pass in</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$access</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$nav</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;navigation&#39;</span><span class="p">);</span> <span class="c1">//get menu items from session</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//excluded pages are the pages we don&#39;t want to execute this filter </span>
</span><span class='line'>    <span class="c1">//since they should always be accessible for a logged in user</span>
</span><span class='line'>    <span class="nv">$excluded_pages</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;it/home&#39;</span><span class="p">,</span> <span class="s1">&#39;defense/home&#39;</span><span class="p">,</span> <span class="s1">&#39;marketing/home&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$current_url</span><span class="p">,</span> <span class="nv">$excluded_pages</span><span class="p">)){</span><span class="c1">//if current page is not an excluded pages</span>
</span><span class='line'>      <span class="k">foreach</span><span class="p">(</span><span class="nv">$nav</span> <span class="k">as</span> <span class="nv">$addresses</span><span class="p">){</span>
</span><span class='line'>        <span class="k">foreach</span><span class="p">(</span><span class="nv">$addresses</span> <span class="k">as</span> <span class="nv">$address</span><span class="p">){</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$address</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)){</span>
</span><span class='line'>            <span class="nv">$full</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="nv">$address</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$page</span> <span class="o">=</span> <span class="nv">$full</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nv">$current_page</span> <span class="o">==</span> <span class="nv">$page</span><span class="p">){</span>
</span><span class='line'>              <span class="nv">$access</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>              <span class="k">return</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nv">$access</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span> <span class="c1">//if user doesn&#39;t have access to the page that he&#39;s trying to access</span>
</span><span class='line'>        <span class="nv">$departments</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="s1">&#39;defense&#39;</span><span class="p">,</span> <span class="s1">&#39;marketing&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$department_id</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;department_id&#39;</span><span class="p">);</span> <span class="c1">//get department id of the current user</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//redirect the user to the homepage of that </span>
</span><span class='line'>        <span class="c1">//department along with some error message that he cannot access that page</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="nv">$departments</span><span class="p">[</span><span class="nv">$department_id</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;/home&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;You don\&#39;t have permission to access the following page: &#39;</span> <span class="o">.</span> <span class="nv">$current_url</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>You can just use the filter for every route which meets the pattern that you have specified:
This will ensure that the users can&rsquo;t actually access the page they&rsquo;re trying to access if its not allowed by the administrator.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nx">Route</span><span class="o">::</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;pattern: admin/*&#39;</span><span class="p">,</span> <span class="s1">&#39;check_roles&#39;</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h4>Controller Detect</h4>

<p>Instead of specifying the controllers one by one we can just use <code>Controller::detect()</code> which
returns an array of all the controllers that we have created (pretty sweet right?).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nx">Route</span><span class="o">::</span><span class="na">Controller</span><span class="p">(</span><span class="nx">Controller</span><span class="o">::</span><span class="na">detect</span><span class="p">());</span> <span class="c1">//create a route for every controller so that its accessible</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h4>Logout</h4>

<p>Finally, the logout. Were just going to call two methods then redirect to the login page.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">Auth</span><span class="o">::</span><span class="na">logout</span><span class="p">();</span> <span class="c1">//logout the current user</span>
</span><span class='line'>  <span class="nx">Session</span><span class="o">::</span><span class="na">flush</span><span class="p">();</span> <span class="c1">//delete the session</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span> <span class="c1">//redirect to login page</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h3>Conclusion</h3>

<p>That&rsquo;s pretty much it. I hope you&rsquo;ve learned a bunch about Laravel by building this project.
Be sure to check out the resources below if you want to learn more about Laravel.</p>

<h3>Resources</h3>

<p>Here are some resources that you can use if ever you get stuck on building this project or if there&rsquo;s something you don&rsquo;t totally understand.</p>

<ul>
<li><a href="http://daylerees.com/category/laravel-tutorials/">Laravel Tutorials by Dayle Rees</a></li>
<li><a href="http://laravel.io/">Ins and Outs of Laravel</a></li>
<li><a href="http://jasonlewis.me/laravel-tutorials">Laravel Tutorials by Jason Lewis</a></li>
<li><a href="http://laravel.com/docs">Official Laravel Documentation</a></li>
<li><a href="http://forums.laravel.com/">Laravel Forums</a></li>
<li><a href="http://net.tutsplus.com/tag/laravel/">Nettuts &ndash; Laravel</a></li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Wern Ancheta</span></span>

      








  



  
<time datetime="2014-01-27T00:00:00+08:00" class="updated">Updated Jan 27<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/laravel-3/'>laravel-3</a>, <a class='category' href='/blog/categories/php/'>php</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://anchetawern.github.io/blog/2012/12/17/building-a-user-management-system-in-laravel/" data-via="wern_ancheta" data-counturl="http://anchetawern.github.io/blog/2012/12/17/building-a-user-management-system-in-laravel/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/12/15/on-formal-education-and-certifications-in-computer-science/" title="Previous Post: On Formal Education and Certifications in Computer Science">&laquo; On Formal Education and Certifications in Computer Science</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/12/17/getting-started-with-unit-testing-in-php/" title="Next Post: Getting Started with Unit Testing in PHP">Getting Started with Unit Testing in PHP &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>


</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/12/29/year-end-review/">Year-End Review</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/22/brain-dump-0/">Brain Dump 0</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/16/getting-started-with-rabbitmq-in-php/">Getting Started with RabbitMQ in PHP</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/08/christmas-wishlist-2014/">Christmas Wishlist 2014</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/25/always-scratch-your-developer-itch/">Always scratch your developer itch</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/anchetawern">@anchetawern</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'anchetawern',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/wernancheta?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/wernancheta">My Delicious Bookmarks &raquo;</a></p>
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/104518132178203766400?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Wern Ancheta -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <span class="donate">
    <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=UR4FM6YHK6K38&amp;lc=PH&amp;item_name=Wern%20Ancheta%27s%20Blog&amp;currency_code=USD&amp;bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHosted">Buy me a cup of coffee</a>
  </span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'wernancheta';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://anchetawern.github.io/blog/2012/12/17/building-a-user-management-system-in-laravel/';
        var disqus_url = 'http://anchetawern.github.io/blog/2012/12/17/building-a-user-management-system-in-laravel/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




<script src="/javascripts/csshttprequest.min.js"></script>
<script>
if($('.entry-title').length == 1){
	var entry_title = $('.entry-title').text();
	CSSHttpRequest.get(
	    "http://phpdev-wern.rhcloud.com/crossdomain/counter.php?title=" + entry_title,
	    function(response){
	  		console.log('updated');  	
	    }
	);
}
</script>
</body>
</html>
